"use strict";function getData(a,n){var e="/restaurant/?group_id=0&offset="+n+"&limit=5",t=a.data.scanCodeDiancan;return util.httpRequest(e).then(function(e){var o=common.dataListHandle(a,e,t.list,n);t.list=o.list,a.setData({scanCodeDiancan:t,requestStatus:!0,peise:getApp().globalData.peise})})}function getHdhInfo(a){var n=a.data.scanCodeDiancan,e=common.getStorage("hdhInfo");e&&e.hasOwnProperty("id")?(n.shopInfo=e,a.setData({scanCodeDiancan:n})):common.hdhInfo().then(function(e){n.shopInfo=e,a.setData({scanCodeDiancan:n})})}function getConfigInfo(a,n){var e="/hdh/"+getApp().globalData.acid+"/config/?key=restaurant",t=common.getStorage("config");util.httpRequest(e).then(function(e){if(!e.restaurant.module)return void common.showClickModal(e.restaurant.msg);if(!e.restaurant.hasOwnProperty("busTime")){var o={working:!1};e.restaurant.busTime=o}if(!e.restaurant.hasOwnProperty("takeaway")){var i={working:!1};e.restaurant.takeaway=i}var s=e.restaurant;if(a.state.options){var r=a.data.isWorking;r="wm"===a.state.options.enterWay?s.takeaway.working:s.busTime.working,a.store({isWorking:r,restaurant:s,underlinePay:e.ui.underlinePay})}else a.store({restaurant:s});t.underlinePay=e.ui.underlinePay,t.restaurant=e.restaurant,common.setStorage("config",t),n()})}function saomaDiancan(){wx.scanCode({onlyFromCamera:!0,success:function(a){if(console.log(a),a.hasOwnProperty("path")){var n=a.path;if(n){var e=n.split("?"),t=e[1].split("="),o=t[1].split("_");"dc"===o[0]?wx.navigateTo({url:"/pages/dianCan/pages/saomaDiancan/saomaDiancan?enterWay=dc&id="+o[1]}):common.showClickModal("无效的小程序码！")}}else common.showClickModal("无效的小程序码！")}})}function waimai(a,n){var e=a.data.restaurant,t=a.data.scanCodeDiancan;1===Number(e.takeaway.open)?(e.takeaway.working&&e.busTime.working?wx.navigateTo({url:"/pages/dianCan/pages/saomaDiancan/saomaDiancan?enterWay=wm&detail_id="+n.detail_id+"&group_id="+n.group_id}):e.busTime.working?common.showClickModal("当前不在配送时间段！"):common.showClickModal("餐厅已打烊！"),t.alter[0]="hide",a.store({scanCodeDiancan:t})):common.showClickModal("本店暂不支持外卖！")}function xianxiaBuyDan(){common.showClickModal("该功能暂未开放！")}function seeDetail(a,n){var e=n.index,t=a.data.scanCodeDiancan;t.alter[0]="show",t.detail=t.list[e],a.store({scanCodeDiancan:t})}function closealter(a){var n=a.data.scanCodeDiancan;n.alter[0]="hide",a.store({scanCodeDiancan:n})}function dianCanEvent(a){var n=this,e=common.getStorage("config");if(!e.restaurant.module)return void common.showClickModal(e.restaurant.msg);var t=a.currentTarget.dataset;if("location"===t.types){var o=n.data.scanCodeDiancan.shopInfo.location;common.openMap(o.lat,o.lng)}else if("saoma"===t.types)saomaDiancan();else if("waimai"===t.types)waimai(n,t);else if("maidan"===t.types)xianxiaBuyDan();else if("call"===t.types)common.phoneCall(n.data.scanCodeDiancan.shopInfo.customer_service.tel);else if("detail"===t.types)seeDetail(n,t);else if("close"===t.types)closealter(n);else if("bigImg"===t.types){var i=a.currentTarget.dataset.url,s=n.data.scanCodeDiancan.detail.attachments;s.length>1?common.see_oss_bject(i,s):common.seeBigImg(1,i,"")}}function diancanShow(a){a.dianCanEvent=dianCanEvent,getConfigInfo(a,function(n){common.commonFun(a),common.getAccessToken()?(getHdhInfo(a),getData(a,0)):getApp().globalData.tokenUpdated=function(){console.log("update success"),getHdhInfo(a),getData(a,0)}})}var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun;module.exports={diancanShow:diancanShow,dianCanEvent:dianCanEvent,getData:getData,seeDetail:seeDetail,closealter:closealter,getConfigInfo:getConfigInfo,getHdhInfo:getHdhInfo};