"use strict";var util=getApp().globalData.utilFun,common=getApp().globalData.commonFun,dataTemp=getApp().globalData.dataTempFun,WxParse=require("../../../../wxParse/wxParse.js"),yuexpert=require("../../../commonPage/yuexpert/temp.js");Page({data:{shareAlter:"hide",shareAlter1:"hide",adStatus:!0,detail:{},peise:getApp().globalData.peise,service_class:"hide",Hoteldisplay:"hide",services:[],currentTab:0,timeTab:-1,weeks:[],times:[],dis:"true",disBg:"",Clockdis:"block",Clockdis2:"none",dd:"",hotelweeks:["日","一","二","三","四","五","六"],monidx:"",ymd:"",ymd2:[],ymd3:[],months:[],monthnext:[],monthlast:[],left:"",left2:"",left3:"",flag:1,ym1:"",ym2:"",index1:"",op:"",prices:[],Check2:"",requestStatus:!1},state:{options:{},theme:""},onLoad:function(e){console.log(e);var t=decodeURIComponent(e.scene);console.log(t);var a={};if("undefined"!=t){var i=t.split("#");a={idx:i[0],uid:i[1]}}else a=e;console.log(a),wx.showLoading({title:"加载中...",mask:!0}),this.state.options=a;var s=this;common.getAccessToken()?(common.commonFun(s),s.getData(a.idx,!0)):getApp().globalData.tokenUpdated=function(){console.log("update success"),common.commonFun(s),s.getData(a.idx,!0)}},onShow:function(){var e=this;getApp().globalData.serviceUpdateDetailData=function(){e.getData(e.state.options.idx,!1)}},getData:function(e,t){var a=this;common.shareLog(this,9,e);var i=this,s="/api/ExpertToClient/getExpertDetails?id="+e,o=this.state.options;o.hasOwnProperty("uid")&&(s+="&uid="+o.uid),util.httpRequest(s,{},"GET","v2").then(function(e){if("success"===e.result){wx.setNavigationBarTitle({title:e.data.name}),0===Number(e.data.dateType)?i.state.theme=!1:i.state.theme=!0;var s=e.data.ExpertItem;a.setData({servicesInfo:e,detail:e.data,services:s,weeks:e.data.weekNum,times:e.data.timeStr,isShareTimeline:e.isShareTimeline,requestStatus:!0}),t&&wx.pro.fromSync(function(t){var a=WxParse.wxParse("article","html",e.data.detail,i,5);i.setData(a)}),yuexpert.getYMD(a)}else common.showClickModal(e.msg);wx.hideLoading()})},Reservation:function(){var e=this;getApp().globalData.confirmService={chosedTime:e.data.weeks[e.data.currentTab].Ymd,chosedClock:e.data.times[e.data.currentTab].time[e.data.timeTab],theme:e.state.theme,daydates:0};var t=this.state.options,a="../Reservation/Reservation?id="+t.idx;t.hasOwnProperty("index")&&(a+="&index="+t.index),wx.navigateTo({url:a}),this.detailClose()},choseday:function(e){yuexpert.choseday(e,this)},choseday2:function(e){yuexpert.choseday2(e,this)},choseday3:function(e){yuexpert.choseday3(e,this)},BombBox:function(e){e.id=this.data.detail.id,e.typeid=30,e.remark="service_zhuanjia",common.getFormId(e),this.state.theme?this.setData({service_class:"hide",Hoteldisplay:"block"}):this.setData({service_class:"block",Hoteldisplay:"hide"})},detailClose:function(){this.setData({service_class:"hide",Hoteldisplay:"hide"})},navbarTap:function(e){this.setData({currentTab:e.currentTarget.dataset.idx,timeTab:-1,dis:!0})},timebarTap:function(e){yuexpert.selectTime(this,e)},shareEvent:function(e){e.type="v2",e.url="/api/ExpertToClient/ShareProduct?id="+this.data.detail.id+"&type=1",dataTemp.detailShare(this,e)},onShareAppMessage:function(){var e=this.data.detail,t=this.data.myInfo.id;return{title:e.name,path:"pages/service/pages/personal/personal?formType=1&idx="+e.id+"&uid="+t,success:function(e){}}}});