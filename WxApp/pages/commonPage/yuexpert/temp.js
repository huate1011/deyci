"use strict";function getnav(t){util.httpRequest("/api/ExpertToClient/getClass",{},"GET","v2").then(function(a){t.setData({yunavs:a.data})})}function getList(t,a){var e="/api/ExpertToClient/getExpertList?offset="+a+"&limit="+t.state.limit,n=t.state.classId;common.isNull(n)||(e+="&classId="+n);var s=t.state.server_keyword;s&&(e+="&key="+s),util.httpRequest(e,{},"GET","v2").then(function(e){if("success"===e.result){var n=common.dataListHandle(t,e,t.data.list,a);t.setData({list:n.list,requestStatus:!0,hasNext:n.hasNext})}else common.showClickModal(e.msg);0===Number(a)&&common.updateTabOffsetTop(t)})}function service_getDetail(t,a){var e=t.data.list;if(e[a]){var n="/api/ExpertToClient/getExpertDetails?id="+e[a].id;util.httpRequest(n,{},"GET","v2").then(function(n){"success"===n.result&&(e[a].Grade=n.data.Grade,e[a].doneNum=n.data.doneNum,t.setData({list:e}))})}}function navbarTap(t,a){var e=a.currentTarget.dataset.idx;Number(e)!==Number(t.data.currentTab)&&(wx.showLoading({title:"加载中...",mask:!0}),t.state.server_keyword="",t.setData({currentTab:e,list:[],requestStatus:!1}),t.state.classId=a.currentTarget.dataset.typeid,t.state.offset=0,getList(t,0))}function deleteOrder(t,a){wx.showModal({title:"提示",content:"确定要删除吗？",success:function(e){if(e.confirm){wx.showLoading({title:"",mask:!0});var n="/api/ExpertToClient/deleteOrder?id="+t;util.httpRequest(n,{},"GET","v2").then(function(t){wx.hideLoading(),a(t)})}}})}function orderRefund(t,a,e){wx.showModal({title:"提示",content:"确定要申请退款吗？",success:function(n){if(n.confirm){wx.showLoading({title:"",mask:!0});var s={id:t,remark:a};util.httpRequest("/api/ExpertToClient/applyRefund",s,"POST","v2").then(function(t){wx.hideLoading(),e(t)})}}})}function getYMD(t){for(var a=new Date,e=[],n=[],s=[],o=a.getMonth()+1,r=a.getFullYear(),d=a.getDate(),l=d-1,i=o+1,m=new Date(r+"-"+p),h=new Date(v+"-"+i),c=new Date(u+"-"+f),g=1;g<=new Date(r,o,0).getDate();g++)e.push({day:g,state:0});if(i>12)var i=1,v=r+1;else var v=r;var f=i+1;if(f>12)var f=1,u=v+1;else var u=v;if(o<10)var p="0"+o;else var p=o;if(i<10)var i="0"+i;else var i=i;if(f<10)var f="0"+f;else var f=f;if(d<10)var d="0"+d;else var d=d;for(var x=1;x<=new Date(r,i,0).getDate();x++)n.push({day:x,state:0});for(var D=1;D<=new Date(r,f,0).getDate();D++)s.push({day:D,state:0});t.setData({months:e,monthnext:n,monthlast:s,ymd2:v+"-"+i,ymd3:u+"-"+f,ymd:r+"-"+p,ymdd:r+"-"+p+"-"+d,left:106*m.getDay()+"rpx",left2:106*h.getDay()+"rpx",left3:106*c.getDay()+"rpx",monidx:l})}function choseday(t,a){var e=t.currentTarget.dataset.days,n=t.currentTarget.dataset.co+1,s=t.currentTarget.dataset.co;if(n<10)var n="0"+n;else var n=n;a.setData({monthnext:a.data.monthnext,monthlast:a.data.monthlast,months:a.data.months});var o=a.data.flag;if(2==o){var r=e+"-"+n;a.setData({flag:1}),console.log("离店时间"+r);var d=new Date(Date.parse(r.replace(/-/g,"/"))).getTime(),l=new Date(Date.parse(a.data.ym1.replace(/-/g,"/"))).getTime(),i=(d-l)/864e5;a.data.index1;if(i<0)a.data.months[s].state=0,a.setData({flag:2});else if(0==i)a.data.months[s].state=1,a.setData({flag:2});else{a.data.months[s].state=1;for(var m=a.data.index1;m<=s;m++)a.data.months[m].state=1;getApp().globalData.confirmService={chosedTime:a.data.ym1,chosedClock:r,theme:a.state.theme,daydates:i};var h=a.state.options;wx.navigateTo({url:"../Reservation/Reservation?id="+h.idx+"&index="+h.index}),a.detailClose()}a.setData({months:a.data.months}),console.log("总共"+i+"天")}else{var l=e+"-"+n;o++;for(var c=0;c<a.data.months.length;c++)a.data.months[c].state=0;for(var t=0;t<a.data.monthnext.length;t++)a.data.monthnext[t].state=0;for(var g=0;g<a.data.monthlast.length;g++)a.data.monthlast[g].state=0;a.setData({months:a.data.months,monthnext:a.data.monthnext,monthlast:a.data.monthlast});var v=l.replace(/\-/gi,"/"),f=a.data.ymdd.replace(/\-/gi,"/");new Date(v).getTime()<new Date(f).getTime()?(a.data.months[s].state=0,wx.showModal({title:"温馨提示",content:"请选择当前较大时间",showCancel:!1})):(a.data.months[s].state=1,a.setData({flag:o,ym1:l,months:a.data.months,index1:s})),console.log("入住时间"+l)}}function choseday2(t,a){var e=t.currentTarget.dataset.days,n=t.currentTarget.dataset.co+1,s=t.currentTarget.dataset.co;if(n<10)var n="0"+n;else var n=n;a.setData({monthnext:a.data.monthnext,monthlast:a.data.monthlast,months:a.data.months});var o=a.data.flag;if(2==o){var r=e+"-"+n;a.setData({flag:1,ym2:r}),console.log("离店时间"+r);var d=new Date(Date.parse(r.replace(/-/g,"/"))).getTime(),l=new Date(Date.parse(a.data.ym1.replace(/-/g,"/"))).getTime(),i=a.data.ym1.split("-"),m=a.data.ym2.split("-");i=12*parseInt(i[0])+parseInt(i[1]),m=12*parseInt(m[0])+parseInt(m[1]);var h=Math.abs(i-m),c=(d-l)/864e5,g=a.data.index1;if(c<0)a.data.monthnext[s].state=0,a.setData({flag:2});else if(0==c)a.data.monthnext[s].state=1,a.setData({flag:2});else{if(0==h)for(var v=a.data.index1;v<=s;v++)a.data.monthnext[v].state=1;else{for(var f=g;f<a.data.months.length;f++)a.data.months[f].state=1,a.setData({months:a.data.months});for(var u=0;u<=s;u++)a.data.monthnext[u].state=1}getApp().globalData.confirmService={chosedTime:a.data.ym1,chosedClock:r,theme:a.state.theme,daydates:c};var p=a.state.options;wx.navigateTo({url:"../Reservation/Reservation?id="+p.idx+"&index="+p.index}),a.detailClose()}a.setData({monthnext:a.data.monthnext}),console.log("总共"+c+"天")}else{var l=e+"-"+n;o++;for(var x=0;x<a.data.months.length;x++)a.data.months[x].state=0;for(var t=0;t<a.data.monthnext.length;t++)a.data.monthnext[t].state=0;for(var D=0;D<a.data.monthlast.length;D++)a.data.monthlast[D].state=0;a.setData({months:a.data.months,monthnext:a.data.monthnext,monthlast:a.data.monthlast});for(var x=0;x<a.data.monthnext.length;x++)a.data.monthnext[x].state=0;a.data.monthnext[s].state=1,a.setData({flag:o,ym1:l,monthnext:a.data.monthnext,index1:s}),console.log("入住时间"+l)}}function choseday3(t,a){var e=t.currentTarget.dataset.days,n=t.currentTarget.dataset.co+1,s=t.currentTarget.dataset.co;if(n<10)var n="0"+n;else var n=n;a.setData({monthnext:a.data.monthnext,monthlast:a.data.monthlast,months:a.data.months});var o=a.data.flag;if(2==o){var r=e+"-"+n;a.setData({flag:1,ym2:r}),console.log("离店时间"+r);var d=new Date(Date.parse(r.replace(/-/g,"/"))).getTime(),l=new Date(Date.parse(a.data.ym1.replace(/-/g,"/"))).getTime(),i=a.data.ym1.split("-"),m=a.data.ym2.split("-");i=12*parseInt(i[0])+parseInt(i[1]),m=12*parseInt(m[0])+parseInt(m[1]);var h=Math.abs(i-m);console.log("相差"+h);var c=(d-l)/864e5,g=a.data.index1;if(c<0)a.data.monthlast[s].state=0,a.setData({flag:2});else if(0==c)a.data.monthlast[s].state=1,a.setData({flag:2});else{if(0==h)for(var v=g;v<=s;v++)a.data.monthlast[v].state=1;else if(1==h){console.log(a.data.months.length);for(var f=g;f<a.data.monthnext.length;f++)a.data.monthnext[f].state=1,a.data.monthlast[s].state=1;for(var u=0;u<s;u++)a.data.monthlast[u].state=1}else{for(var p=0;p<a.data.monthnext.length;p++)a.data.monthnext[p].state=1;for(var f=g;f<a.data.months.length;f++)a.data.months[f].state=1;for(var u=0;u<=s;u++)a.data.monthlast[u].state=1}a.setData({months:a.data.months,monthnext:a.data.monthnext,monthlast:a.data.monthlast}),getApp().globalData.confirmService={chosedTime:a.data.ym1,chosedClock:r,theme:a.state.theme,daydates:c};var x=a.state.options;wx.navigateTo({url:"../Reservation/Reservation?id="+x.idx+"&index="+x.index}),a.detailClose()}console.log("总共"+c+"天")}else{var l=e+"-"+n;o++;for(var D=0;D<a.data.months.length;D++)a.data.months[D].state=0;for(var t=0;t<a.data.monthnext.length;t++)a.data.monthnext[t].state=0;for(var T=0;T<a.data.monthlast.length;T++)a.data.monthlast[T].state=0;a.setData({months:a.data.months,monthnext:a.data.monthnext,monthlast:a.data.monthlast});for(var D=0;D<a.data.monthlast.length;D++)a.data.monthlast[D].state=0;a.data.monthlast[s].state=1,a.setData({flag:o,ym1:l,monthlast:a.data.monthlast,index1:s}),console.log(a.data.flag),console.log("入住时间"+l)}}function selectTime(t,a){var e=a.currentTarget.dataset.codes,n=t.data.currentTab;e<t.data.times[n].key||0==t.data.times[n].num[e]?(t.setData({dis:!0,timeTab:e}),common.showClickModal("当前时间段已无法预约")):t.setData({dis:!1,timeTab:e})}function serverEvent(t){serverEventCheng(this,t)}function hideIcon(){this.store({iconStatus:!1})}function newsBlurInput(t){var a=t.detail.value;common.isNull(a)&&this.store({iconStatus:!0})}function getData(t){dataTemp.getBanner(t,"service"),getnav(t),getList(t,0),t.setData({isFixed:!1}),common.commonFun(t),t.serverEvent=serverEvent,t.hideIcon=hideIcon,t.newsBlurInput=newsBlurInput}function serverEventCheng(t,a){var e=a.currentTarget.dataset;"navbarTap"===e.types?navbarTap(t,a):"search"===e.types&&(t.state.server_keyword=a.detail.value,t.state.classId=0,t.state.offset=0,getList(t,0))}var util=getApp().globalData.utilFun,common=getApp().globalData.commonFun,dataTemp=getApp().globalData.dataTempFun;module.exports={getData:getData,getnav:getnav,getList:getList,navbarTap:navbarTap,deleteOrder:deleteOrder,orderRefund:orderRefund,serverEventCheng:serverEventCheng,service_getDetail:service_getDetail,selectTime:selectTime,getYMD:getYMD,choseday:choseday,choseday2:choseday2,choseday3:choseday3};