"use strict";function openDanpinDetail(a){var t=a.currentTarget.dataset,e=t.kind,n=t.id,o="";e&&("video"===e?o="/pages/zhuanlan/pages/danpinVideoDetail/danpinVideoDetail?danpinId="+n:"audio"===e&&(o="/pages/zhuanlan/pages/danpinAudeoDetail/danpinAudeoDetail?danpinId="+n),"article"===e&&(o="/pages/zhuanlan/pages/danpinTuwenDetail/danpinTuwenDetail?danpinId="+n),"zhuanlan"===e&&(o="/pages/zhuanlan/pages/zhuanlanDetail/zhuanlanDetail?zhuanlanId="+n),o+="&indexOf="+t.index,wx.navigateTo({url:o}))}function learnChangeEvent(a,t){var e=t.currentTarget.dataset;if("searchBtn"===e.types){var n=[{name:"search",data:{placeholder:"搜索",type:a.state.learnSearchType}}];common.setStorage("layout",n),wx.navigateTo({url:"/pages/common/pages/search/search"})}else if("pickerChange"===e.types)pickerChange(a,t);else if("getFormId"===e.types)getFormId(t);else if("colSearchBtn"===e.types){var o=[{name:"search",data:{placeholder:"搜索",type:"col"}}];common.setStorage("layout",o),wx.navigateTo({url:"/pages/common/pages/search/search"})}else if("digSearchBtn"===e.types){var i=[{name:"search",data:{placeholder:"搜索",type:"digitalcontent"}}];common.setStorage("layout",i),wx.navigateTo({url:"/pages/common/pages/search/search"})}else"toAudeoDetail"===e.types&&audeoDetail(a.data.audeo_play_status,getApp().globalData.audioData.audioId)}function zhuanlanList(a){dataTemp.getBanner(a,"learn");var t=a.data.info,e="/hdh/"+getApp().globalData.acid+"/column/?offset=0&limit=2";util.httpRequest(e).then(function(e){wx.stopPullDownRefresh(),t.zhuanlanList=e.results,t.hasNext=!0,t.joinNumStatue="show",a.setData({info:t,requestStatus:!0,logoPosBottom:!1});var n="/hdh/"+getApp().globalData.acid+"/digitalcontent/?offset=0&limit=3";return util.httpRequest(n)}).then(function(t){a.state.pageOnShow=!0,a.setData({danpinList:t.results,requestStatus:!0,hasNext:!0,logoPosBottom:!1}),wx.hideLoading()})}function danpinDetail(a){openDanpinDetail(a)}function learnEvent(a){learnChangeEvent(this,a)}function zhuanlanIndex(a){common.configData("learn",function(){common.commonFun(a);var t=common.getStorage("config").learn;t.module?zhuanlanList(a):common.showClickModal(t.msg)}),a.danpinDetail=danpinDetail,a.learnEvent=learnEvent}function zlList(a,t){var e=a.data.info,n="/hdh/"+getApp().globalData.acid+"/column/?offset="+t+"&limit="+a.state.limit;util.httpRequest(n).then(function(n){wx.stopPullDownRefresh();var o=common.dataListHandle(a,n,e.zhuanlanList,t);e.zhuanlanList=o.list,e.joinNumStatue="show",e.hasNext=o.hasNext;var i=!1;0===o.list.length&&(i=!0),a.setData({info:e,requestStatus:!0,logoPosBottom:i})})}function dplist(a,t){var e="/hdh/"+getApp().globalData.acid+"/digitalcontent/?offset="+t+"&limit="+a.state.limit;util.httpRequest(e).then(function(e){wx.stopPullDownRefresh();var n=common.dataListHandle(a,e,a.data.danpinList,t),o=!1;0===n.list.length&&(o=!0),a.setData({danpinList:n.list,hasNext:n.hasNext,requestStatus:!0,logoPosBottom:o})})}function learnIndex(a,t){common.configData("learn",function(){common.commonFun(a);var e=common.getStorage("config");a.setData({config:e}),e.learn.module?"zhuanlan"===t?zlList(a,0):"danpin"===t&&dplist(a,0):common.showClickModal(e.learn.msg)}),a.danpinDetail=danpinDetail,a.learnEvent=learnEvent}function getDanpinDetail(a,t,e){var n=a.data.danpinList;if(n[e]){var o="/digitalcontent/"+t+"/";util.httpRequest(o).then(function(t){n[e].view_count=t.view_count,n[e].comment_count=t.comment_count,n[e].has_bought=t.update_has_bought,n[e].like_count=t.like_count,a.setData({danpinList:n})})}}function getZhuanlanDetail(a,t,e){var n=a.data.info;if(n.zhuanlanList[e]){var o="/column/"+t+"/";util.httpRequest(o).then(function(t){n.zhuanlanList[e].update_hint=t.update_hint,n.zhuanlanList[e].subscrib_count=t.subscrib_count,n.zhuanlanList[e].has_subscribed=t.has_subscribed,a.setData({info:n})})}}function getData(a,t){"zhuanlan"===a.state.dataType?zlList(a,t):"danpin"===a.state.dataType&&dplist(a,t),a.danpinDetail=danpinDetail,a.learnEvent=learnEvent}function calculatePrice(a,t,e){var n=a.data.tgDataDetail,o=a.data.convertible;if(n.skus){var i={cartsku:[{sku_id:n.skus[0].id,count:a.data.isGift?a.data.giveNum:1}],module:"learn",types:a.state.pageName,id:a.state.learnId};a.data.isGift?i.from="gift":i.coupon_id=t;util.httpRequest("/order/price/",i,"POST").then(function(t){var n=a.data.detail,i=t.order.price.discount;0!==t.order.price.total_price||a.data.coupon||(o=!1),e?a.store({convertible:o,discount:i,detail:n,total_money:t.order.price.total_price,showPayMethod:!0}):a.store({convertible:o,discount:i,detail:n,total_money:t.order.price.total_price})})}}function onUseCode(a){var t=a.data.useCode;t=!t,a.store({useCode:t})}function getCoupon(a,t){wx.showLoading({title:"",mask:!0});var e=a.state.pageName,n={redeem_code:t,action:"take",product_id:a.data.detail.fee_product_id};util.httpRequest("/coupon/",n,"POST").then(function(t){if(wx.hideLoading(),"fail"===t.result)return void common.showClickModal(t.msg);"shop"===e?a.calculateOrderPrice():calculatePrice(a,t.coupon.id),a.store({coupon:t.coupon,selectedCoupon:t.coupon})})}function changeVal(a,t){var e=a.detail.value;8===e.length&&getCoupon(t,e),t.store({codeVal:e})}function columnShare(a,t){wx.navigateTo({url:"/pages/zhuanlan/pages/zhuanlanDetailShare/zhuanlanDetailShare?id="+t})}function pickerChange(a,t){var e=t.detail.value,n=a.data.learnSearchMenu,o=a.state.learnSearchMenu1;a.state.learnSearchType=o[e],a.setData({learndefaultval:n[e]})}function getFormId(a){var t="/product/"+a.currentTarget.dataset.productid+"/log/",e={wx_form_id:a.detail.formId,action:"view"};return openDanpinDetail(a),util.httpRequest(t,e,"POST").then(function(a){})}function audeoDetail(a,t){a?wx.navigateTo({url:"/pages/zhuanlan/pages/danpinAudeoDetail/danpinAudeoDetail?danpinId="+t}):common.showClickModal("当前无播放节目")}var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun,dataTemp=getApp().globalData.dataTempFun;module.exports={getData:getData,getZhuanlanDetail:getZhuanlanDetail,getDanpinDetail:getDanpinDetail,onUseCode:onUseCode,changeVal:changeVal,columnShare:columnShare,calculatePrice:calculatePrice,zhuanlanIndex:zhuanlanIndex,learnIndex:learnIndex,zlList:zlList,dplist:dplist,learnChangeEvent:learnChangeEvent,openDanpinDetail:openDanpinDetail};