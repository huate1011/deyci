"use strict";function _defineProperty(t,a,e){return a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e,t}function getList(t,a){wx.showLoading({title:"加载中...",mask:!0});var e="/api/HotelToClient/getHotelList?offset="+a+"&limit="+t.state.limit;e+="&rank="+t.state.rank,e+="&status="+t.data.currentTab;var s=t.state.lng;s&&(e+="&lng="+s);var n=t.state.lat;n&&(e+="&lat="+n);var o=t.state.keysearch;o&&(e+="&key="+o),util.httpRequest(e,{},"GET","v2").then(function(e){if("success"===e.result){var s=common.dataListHandle(t,e,t.data.list,a),n=[];t.setData({list:s.list,requestStatus:!0,hasNext:s.hasNext});for(var o=0;o<e.results.length;o++){n.push((e.results[o].distance/1e3).toFixed(2));var l="list["+o+"].distance";t.setData(_defineProperty({},l,n[o]))}}else common.showClickModal(e.msg)})}function hotelEvent(t){hotelEventCheng(this,t)}function getData(t){wx.showLoading({title:"加载中...",mask:!0}),common.commonFun(t),t.hotelEvent=hotelEvent,dataTemp.getBanner(t,"hotel"),t.setData({isFixed:!1}),wx.getLocation({success:function(a){t.setData({hasLocation:!0,location:{lng:a.longitude,lat:a.latitude}}),getList(t,0)},fail:function(a){t.setData({location:{lng:null,lat:null}}),getList(t,0)}})}function BombBox(t){wx.getSystemInfo({success:function(a){t.setData({service_class:"block",Hoteldisplay:"block",isheight:a.windowHeight+"px",isover:"hidden"})}})}function detailClose(t){t.setData({Hoteldisplay:"hide",service_class:"hide",Rankdis:"none",isheight:"auto",isover:"auto"})}function navbarTap(t,a){var e=a.currentTarget.dataset.av;0==e?(t.state.offset=0,t.state.keysearch="",getList(t,0)):"none"==t.data.Rankdis?t.data.Rankdis="block":t.data.Rankdis="none",t.setData({currentTab:e,requestStatus:[],Rankdis:t.data.Rankdis})}function many(t,a){t.currentTarget.dataset;a.state.keysearch=a.data.searchVal,a.state.offset=0,getList(a,0)}function search(t,a){t.setData({searchVal:a.detail.value})}function selectRank(t,a){var e=a.currentTarget.dataset.idx;t.state.offset=0,wx.showLoading({title:"加载中...",mask:!0}),t.state.rank=0==e?"asc":"desc",1==t.data.currentTab?common.currentLocation(0,function(a){console.log(a),t.state.lat=a.latitude,t.state.lng=a.longitude,common.setStorage("position",{lat:a.latitude,lng:a.longitude}),getList(t,0)}):getList(t,0),detailClose(t)}function Hoteldetails(t,a){var e=a.currentTarget.dataset.mx;getApp().globalData.confirmService={chosedTime:t.data.chosedTime,chosedClock:t.data.chosedClock,daydates:t.data.daydates,distance:t.data.list[e].distance},wx.navigateTo({url:"/pages/hotel/pages/Hoteldetails/Hoteldetails?hotelid="+t.data.list[e].id})}function getData2(t,a,e,s){var n="/api/HotelToClient/getHotelDetails?id="+a+"&startTime="+e+"&overTime="+s,o=t.state.options;o.hasOwnProperty("uid")&&(n+="&uid="+o.uid),wx.showLoading({title:"加载中...",mask:!0}),util.httpRequest(n,{},"GET","v2").then(function(a){"success"===a.result?(t.state.productId=a.data.Distribution.Dis_id,t.setData({list:a.data,facilities:a.data.amenities,requestStatus:!0,tgDataDetail:{title:a.data.name,cover:{thumb_small_url:a.data.photo.thumb_medium_url}}}),wx.pro.fromSync(function(e){if(a.data.details){var s=WxParse.wxParse("article","html",a.data.details,t,5);t.setData(s)}})):common.showClickModal(a.msg),wx.hideLoading()})}function getYMD(t){var a=new Date,e=new Date,s=[],n=[],o=[],l=a.getMonth()+1,d=a.getFullYear(),r=a.getDate(),m=r-1,h=l+1,i=h+1;if(l<10)var c="0"+l;else var c=l;for(var g=1;g<=new Date(d,l,0).getDate();g++)s.push({day:g,state:0,nv:""});if(h>12)var h=1,v=d+1;else var v=d;if(i>12)var i=1,f=v+1;else var f=v;if(h<10)var h="0"+h;else var h=h;if(i<10)var i="0"+i;else var i=i;if(r<10)var r="0"+r;else var r=r;for(var u=new Date(d+"-"+c),x=new Date(v+"-"+h),D=new Date(f+"-"+i),p=1;p<=new Date(d,h,0).getDate();p++)n.push({day:p,state:0,nv:""});for(var y=1;y<=new Date(d,i,0).getDate();y++)o.push({day:y,state:0,nv:""});var T=a.getTime()+864e5;a.setTime(T);var w=a.getMonth()+1,b="",k=a.getDate(),C="";b=w<10?"0"+w:w,b=w<10?"0"+w:w,C=k<10?"0"+k:k;var L=a.getFullYear()+"-"+b+"-"+C,H=T-e.getTime(),S=parseInt(H/864e5);t.setData({months:s,monthnext:n,monthlast:o,ymd2:v+"-"+h,ymd3:f+"-"+i,ymd:d+"-"+c,ymdd:d+"-"+c+"-"+r,chosedTime:d+"-"+c+"-"+r,chosedClock:L,left:104*u.getDay()+"rpx",left2:104*x.getDay()+"rpx",left3:104*D.getDay()+"rpx",monidx:m,daydates:S})}function choseday(t,a,e,s,n){var o=t.currentTarget.dataset.days,l=t.currentTarget.dataset.co+1,d=t.currentTarget.dataset.co;l<10&&(l="0"+l);var r=a.data.flag;if(2===Number(r)){var m=o+"-"+l;console.log("离店时间"+m);var h=new Date(Date.parse(m.replace(/-/g,"/"))).getTime(),i=new Date(Date.parse(a.data.ym1.replace(/-/g,"/"))).getTime(),c=(h-i)/864e5,g=a.data.index1;if(c<0&&d>=a.data.monidx)a.data.months[d].state=1,a.data.months[g].state=0,a.data.months[g].nv="",a.data.monthnext[g].state=0,a.data.monthnext[g].nv="",a.data.monthlast[g].state=0,a.data.monthlast[g].nv="",a.data.months[d].nv="入住",a.setData({flag:2,ym1:m,months:a.data.months,monthnext:a.data.monthnext,monthlast:a.data.monthlast,index1:d});else if(d<a.data.monidx)a.data.months[d].state=0,a.setData({flag:2});else if(0===Number(c))a.data.months[d].state=1,a.setData({flag:2});else{a.data.months[d].state=1,a.data.months[d].nv="离店";for(var v=a.data.index1+1;v<d;v+=1)a.data.months[v].state=2;if(1==getCurrentPages().length)getData(a,0,a.data.chosedTime);else{var f=(getApp().globalData.confirmService,a.data.list.id);getData2(a,f,a.data.ym1,m)}a.setData({months:a.data.months,chosedTime:a.data.ym1,chosedClock:m,daydates:c,flag:1}),detailClose(a)}console.log("总共"+c+"天")}else{var u=o+"-"+l;r+=1;for(var x=0;x<a.data.months.length;x+=1)a.data.months[x].state=0,a.data.months[x].nv="";for(var D=0;D<a.data.monthnext.length;D+=1)a.data.monthnext[D].state=0,a.data.monthnext[D].nv="";for(var p=0;p<a.data.monthlast.length;p+=1)a.data.monthlast[p].state=0,a.data.monthlast[p].nv="";a.setData({months:a.data.months,monthnext:a.data.monthnext,monthlast:a.data.monthlast});for(var y=u.replace(/\-/gi,"/"),T=a.data.ymdd.replace(/\-/gi,"/"),w=new Date(y).getTime(),b=new Date(T).getTime(),k=0;k<a.data.months.length;k++)a.data.months[k].nv="";w<b?(a.data.months[d].state=1,wx.showModal({title:"温馨提示",content:"当前时间无法选择",showCancel:!1})):(a.data.months[d].state=1,a.data.months[d].nv="入住",a.setData({flag:r,ym1:u,months:a.data.months,monthnext:a.data.monthnext,monthlast:a.data.monthlast,index1:d})),console.log("入住时间"+u)}}function choseday2(t,a){var e=t.currentTarget.dataset.days,s=t.currentTarget.dataset.co+1,n=t.currentTarget.dataset.co;s<10&&(s="0"+s);var o=a.data.flag;if(2===Number(o)){var l=e+"-"+s;a.setData({ym2:l}),console.log("离店时间"+l);var d=new Date(Date.parse(l.replace(/-/g,"/"))).getTime(),r=new Date(Date.parse(a.data.ym1.replace(/-/g,"/"))).getTime(),m=a.data.ym1.split("-"),h=a.data.ym2.split("-");m=12*parseInt(m[0])+parseInt(m[1]),h=12*parseInt(h[0])+parseInt(h[1]);var i=Math.abs(m-h),c=(d-r)/864e5,g=a.data.index1;if(c<0)a.data.monthnext[n].state=1,a.data.monthnext[g].state=0,a.data.monthnext[g].nv="",a.data.monthlast[g].state=0,a.data.monthlast[g].nv="",a.data.monthnext[n].nv="入住",a.setData({flag:2,ym1:l,monthnext:a.data.monthnext,monthlast:a.data.monthlast,index1:n});else if(0==Number(c))a.data.monthnext[n].state=1,a.setData({flag:2});else{if(0===Number(i)){for(var v=a.data.index1+1;v<n;v+=1)a.data.monthnext[v].state=2;a.data.monthnext[n].state=1}else{for(var f=g+1;f<a.data.months.length;f+=1)a.data.months[f].state=2,a.setData({months:a.data.months});for(var u=0;u<n;u+=1)a.data.monthnext[u].state=2;a.data.monthnext[n].state=1}if(a.data.monthnext[n].nv="离店",1===getCurrentPages().length)getData(a,0,a.data.chosedTime);else{var x=(getApp().globalData.confirmService,a.data.list.id);getData2(a,x,a.data.ym1,l)}a.setData({monthnext:a.data.monthnext,chosedTime:a.data.ym1,chosedClock:l,daydates:c,flag:1}),detailClose(a)}console.log("总共"+c+"天")}else{var D=e+"-"+s;o+=1;for(var p=0;p<a.data.months.length;p+=1)a.data.months[p].state=0;for(var y=0;y<a.data.monthnext.length;y+=1)a.data.monthnext[y].state=0;for(var T=0;T<a.data.monthlast.length;T+=1)a.data.monthlast[T].state=0;for(var w=0;w<a.data.monthnext.length;w+=1)a.data.monthnext[w].state=0,a.data.monthnext[w].nv="";for(var b=0;b<a.data.months.length;b+=1)a.data.months[b].nv="";for(var k=0;k<a.data.monthlast.length;k+=1)a.data.monthlast[k].nv="";a.data.monthnext[n].state=1,a.data.monthnext[n].nv="入住",a.setData({flag:o,ym1:D,index1:n,months:a.data.months,monthnext:a.data.monthnext,monthlast:a.data.monthlast}),console.log("入住时间"+D)}}function choseday3(t,a){var e=t.currentTarget.dataset.days,s=t.currentTarget.dataset.co+1,n=t.currentTarget.dataset.co;s<10&&(s="0"+s);var o=a.data.flag;if(2===Number(o)){var l=e+"-"+s;a.setData({ym2:l}),console.log("离店时间"+l);var d=new Date(Date.parse(l.replace(/-/g,"/"))).getTime(),r=new Date(Date.parse(a.data.ym1.replace(/-/g,"/"))).getTime(),m=a.data.ym1.split("-"),h=a.data.ym2.split("-");m=12*parseInt(m[0])+parseInt(m[1]),h=12*parseInt(h[0])+parseInt(h[1]);var i=Math.abs(m-h);console.log("相差"+i);var c=(d-r)/864e5,g=a.data.index1;if(c<0)a.data.monthlast[n].state=1,a.data.monthlast[g].state=0,a.data.monthlast[g].nv="",a.data.monthlast[n].nv="入住",a.setData({flag:2,ym1:l,monthlast:a.data.monthlast,index1:n});else if(0==c)a.data.monthlast[n].state=1,a.setData({flag:2});else{if(0==i){for(var v=g+1;v<n;v++)a.data.monthlast[v].state=2;a.data.monthlast[n].state=1}else if(1==i){console.log(a.data.months.length);for(var f=g+1;f<a.data.monthnext.length;f++)a.data.monthnext[f].state=2;a.data.monthlast[n].state=2;for(var u=0;u<n;u++)a.data.monthlast[u].state=2;a.data.monthlast[n].state=1}else{for(var x=0;x<a.data.monthnext.length;x++)a.data.monthnext[x].state=2;for(var f=g+1;f<a.data.months.length;f++)a.data.months[f].state=2;for(var u=0;u<n;u++)a.data.monthlast[u].state=2;a.data.monthlast[n].state=1}if(a.data.monthlast[n].nv="离店",a.setData({months:a.data.months,monthnext:a.data.monthnext,monthlast:a.data.monthlast}),1==getCurrentPages().length)getData(a,0,a.data.chosedTime);else{var D=(getApp().globalData.confirmService,a.data.list.id);getData2(a,D,a.data.ym1,l)}a.setData({chosedTime:a.data.ym1,chosedClock:l,daydates:c,flag:1}),detailClose(a)}console.log("总共"+c+"天")}else{o+=1;for(var p=0;p<a.data.months.length;p+=1)a.data.months[p].state=0;for(var y=0;y<a.data.monthnext.length;y+=1)a.data.monthnext[y].state=0;for(var T=0;T<a.data.monthlast.length;T+=1)a.data.monthlast[T].state=0;for(var w=0;w<a.data.monthnext.length;w+=1)a.data.monthnext[w].state=0,a.data.monthnext[w].nv="";for(var b=0;b<a.data.months.length;b+=1)a.data.months[b].nv="";for(var k=0;k<a.data.monthlast.length;k+=1)a.data.monthlast[k].nv="",a.data.monthlast[k].state=0;a.data.monthlast[n].nv="入住",a.data.monthlast[n].state=1,a.setData({flag:o,ym1:e+"-"+s,index1:n,months:a.data.months,monthnext:a.data.monthnext,monthlast:a.data.monthlast})}}function hotelDataSet(t){t.setData({hotelweeks:["日","一","二","三","四","五","六"],Hoteldisplay:"hide",ymd:"",ymd2:[],ymd3:[],months:[],monthnext:[],monthlast:[],left:"",left2:"",left3:"",flag:1,ym1:"",ym2:"",ymdd:"",service_class:"hide",monidx:"",chosedTime:"",chosedClock:"",daydates:"",navs:["全部","距离","价格","评分"],currentTab:0,searchVal:"",projects:[],hasLocation:!1,location:{},Rankdis:"none",choseSele:[["由近到远","由远到近"],["由低到高","由高到低"],["由低到高","由高到低"]],alterRequestStatus:!0,peise:getApp().globalData.peise}),t.state.rank="asc",t.state.keysearch="",t.state.lat="",t.state.lng="",getYMD(t),common.commonFun(t)}function hotelEventCheng(t,a,e){var s=a.currentTarget.dataset;if("BombBox"===s.types)BombBox(t);else if("navbarTap"===s.types)navbarTap(t,a);else if("selectRank"===s.types)selectRank(t,a);else if("Hoteldetails"===s.types)Hoteldetails(t,a);else if("detailClose"===s.types)detailClose(t);else if("many"===s.types)many(a,t);else if("search"===s.types)search(t,a);else if("choseday"===s.types)choseday(a,t,e);else if("choseday2"===s.types)choseday2(a,t,e);else if("choseday3"===s.types)choseday3(a,t,e);else if("HotelAddress"===s.types){var n=t.data.list[s.index];common.openMap(n.lat,n.lng)}}var util=getApp().globalData.utilFun,common=getApp().globalData.commonFun,dataTemp=getApp().globalData.dataTempFun,WxParse=require("../../../wxParse/wxParse.js");module.exports={getData:getData,getYMD:getYMD,getList:getList,getData2:getData2,hotelEventCheng:hotelEventCheng,hotelDataSet:hotelDataSet};