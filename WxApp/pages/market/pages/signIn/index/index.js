"use strict";var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun,dataTemp=getApp().globalData.dataTempFun,yangdate=require("./sign_in_ss.js");Page({data:{peise:getApp().globalData.peise,list:[],uMonth:"show",nMonth:"hide"},state:{isOnReachBottom:!0,isonPullDownRefresh:!1,offset:0,limit:10,hasmore:!0},onLoad:function(t){wx.showLoading({title:"加载中...",mask:!0})},onShow:function(){wx.setNavigationBarColor({frontColor:"#ffffff",backgroundColor:"#"+getApp().globalData.peise.mcolor});var t=common.getAccessToken(),a=this;t?a.setPageData():getApp().globalData.tokenUpdated=function(){a.setPageData()}},setPageData:function(){var t=new Date,a=(t.getDate(),t.getMonth()),e=a+1,n=t.getFullYear();t.getDate();if(e<10)var o="0"+e;else var o=e;var s=this;dataTemp.getSignInData(function(t){if(wx.hideLoading(),"fail"===t.result)return void common.showClickModal(t.msg);1==Number(t.data.my.status)&&getApp().globalData.updateSignInCallback&&getApp().globalData.updateSignInCallback(),s.setData({data:t.data,showYear:n,showMonth:o}),yangdate.yang_date.bulidCal(n,e,s,t.data.glist.list),s.getList(0)})},qianDaoEvent:function(){var t=this;wx.showLoading({title:"",mask:!0}),util.httpRequest("/api/signIn/signin",{},"GET","v2").then(function(a){t.setPageData(),common.showClickModal(a.msg)})},upperMonth:function(){var t=new Date,a=(t.getDate(),t.getMonth()),e=a,n=t.getFullYear();t.getDate();if(e<10)var o="0"+e;else var o=e;this.getData(n+"-"+o),this.setData({uMonth:"hide",nMonth:"show",showYear:n,showMonth:o})},nextMonth:function(){var t=new Date,a=(t.getDate(),t.getMonth()),e=a+1,n=t.getFullYear();t.getDate();if(e<10)var o="0"+e;else var o=e;this.getData(n+"-"+o),this.setData({uMonth:"show",nMonth:"hide",showYear:n,showMonth:o})},getData:function(t){var a="/api/signIn/glog?date="+t,e=this;util.httpRequest(a,{},"GET","v2").then(function(t){console.log(t.data),yangdate.yang_date.bulidCal(todayYear,todayMonth,e,t.data),wx.hideLoading(),e.state.offset=0,e.getList(0)})},buqianEvent:function(){var t=this,a=t.data.data.my.bupoint;wx.showModal({title:"提示",content:a>0?"补签将会扣除"+a+"积分,是否继续":"是否确认补签",showCancel:!0,success:function(a){a.confirm&&(wx.showLoading({title:"",mask:!0}),util.httpRequest("/api/signIn/makeup",{},"POST","v2").then(function(a){t.setPageData(),common.showClickModal(a.msg)}))}})},getList:function(t){var a="/api/signIn/giftlist?offset="+t+"&limit="+this.state.offset,e=this;util.httpRequest(a,{},"GET","v2").then(function(a){var n=common.dataListHandle(e,a,e.data.list,t);e.setData({list:n.list,requestStatus:!0,hasNext:n.hasNext})})},onReachBottom:function(){this.state.isonPullDownRefresh||this.state.isOnReachBottom&&this.state.hasmore&&(wx.showLoading({title:"加载中...",mask:!0}),this.state.offset+=this.state.limit,this.getList(this.state.offset))},onShareAppMessage:function(t){return{path:"pages/market/pages/signIn/index/index"}}});