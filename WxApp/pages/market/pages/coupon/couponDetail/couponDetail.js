"use strict";var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun;Page({data:{detail:{},contactStatus:!0,interfaceName:"couponDetail",pageGo:"-1"},state:{id:""},onLoad:function(o){wx.showLoading({title:"加载中...",mask:!0}),this.state.id=o.id,this.state.pageGo=o.pageGo;var t=common.getAccessToken(),e=this;t?(e.getCouponDetail(o.id),common.commonFun(e)):getApp().globalData.tokenUpdated=function(){console.log("update success"),e.getCouponDetail(o.id),common.commonFun(e)}},getCouponDetail:function(o){var t=this,e="/coupon/?type_id="+o;util.httpRequest(e).then(function(o){wx.hideLoading();var e=o.applicable_condition.categorie_ids,i=o.applicable_condition.product_ids;common.isNull(e)?common.isNull(i)?common.isNull(e)&&common.isNull(i)&&(o.use_range="全店使用"):o.use_range="指定商品使用":o.use_range="指定类别使用",t.store({detail:o,pageGo:t.state.pageGo})})},onUnload:function(){updateShopIndex},getCoupon:function(o){var t=this;wx.showLoading({title:"",mask:!0});var e=o.currentTarget.dataset.id,i={coupon_type_id:e,action:"take"};util.httpRequest("/coupon/",i,"POST").then(function(o){if(wx.hideLoading(),"success"===o.result){var e=o.msg;common.isNull(o.msg)&&(e="领取成功"),common.showClickModal(e);var i=o.coupon.applicable_condition.categorie_ids,a=o.coupon.applicable_condition.product_ids;common.isNull(i)?common.isNull(a)?common.isNull(i)&&common.isNull(a)&&(o.coupon.use_range="全店使用"):o.coupon.use_range="指定商品使用":o.coupon.use_range="全店使用",t.store({detail:o.coupon})}else common.showClickModal(o.msg)})},toUseCoupon:function(){var o=this.data.detail,t=o.applicable_condition.categorie_ids,e=o.applicable_condition.product_ids;if(common.isNull(t))if(common.isNull(e))common.isNull(t)&&common.isNull(e)&&wx.redirectTo({url:"/pages/mall/pages/shopList/shopList"});else{e=e.split("|");var i=e[0];wx.redirectTo({url:"/pages/mall/pages/shopDetail/shopDetail?productId="+i})}else{t=t.split("|");var a=t[0];wx.redirectTo({url:"/pages/mall/pages/shopList/shopList?categoryid="+a})}},onShareAppMessage:function(o){return{path:"/pages/market/pages/coupon/couponDetail/couponDetail?pageGo=0&id="+this.state.id}},store:function(o){this.setData(o)}});