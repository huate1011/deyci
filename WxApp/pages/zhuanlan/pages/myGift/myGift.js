"use strict";var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun;Page({data:{interfaceName:"myGift",currentTab:0,giveListData:[],giveList:[],receiveList:[],requestStatus:!1,logoPosBottom:!0},state:{offset:0,limit:10,hasmore:!0,isOnReachBottom:!1,pageOnShow:!1},onLoad:function(){wx.showLoading({title:"加载中...",mask:!0});var t=this;common.getAccessToken()?(t.getCanGiveList(0),common.commonFun(t)):getApp().globalData.tokenUpdated=function(){console.log("update success"),t.getCanGiveList(0),common.commonFun(t)}},onShow:function(){this.state.pageOnShow&&this.getCanGiveList(0)},onPullDownRefresh:function(){this.state.isonPullDownRefresh=!0,wx.showLoading({title:"加载中...",mask:!0}),this.store({giveListData:[]}),this.state.offset=0,this.getCanGiveList(0)},onReachBottom:function(){this.state.isonPullDownRefresh||this.state.isOnReachBottom&&this.state.hasmore&&(wx.showLoading({title:"加载中...",mask:!0}),this.state.offset+=this.state.limit,this.getCanGiveList(this.state.offset),this.state.isOnReachBottom=!1)},store:function(t){this.setData(t)},swichNav:function(t){var e=Number(t.currentTarget.dataset.current);this.data.currentTab!==e&&(wx.showLoading({title:"",mask:!0}),this.state.offset=0,this.store({giveListData:[],currentTab:e,requestStatus:!1}),this.getCanGiveList(0))},jempGiveFriends:function(t){var e=t.currentTarget.dataset.id,i=t.currentTarget.dataset.count;Number(i)>0&&wx.navigateTo({url:"../giveFriends/giveFriends?cardid="+e})},getCanGiveList:function(t){var e=this,i=this.data.giveListData,s=[],a=[],o="/hdh/"+common.getExtConfig().acid+"/giftcard/?offset="+t+"&limit="+this.state.limit;util.httpRequest(o).then(function(o){var n=common.dataListHandle(e,o,i,t);n.list.forEach(function(t){t.count>0&&s.push(t),t.sent_count>0&&a.push(t)}),e.store({giveList:s,receiveList:a,giveListData:n.list,requestStatus:!0})})},jumpColumn:function(t){var e=t.currentTarget.dataset.id;wx.navigateTo({url:"../getRecords/getRecords?id="+e})}});