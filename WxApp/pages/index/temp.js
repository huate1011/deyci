"use strict";function receiveCoupon(e){wx.showLoading({title:"",mask:!0});var t=this,a=e.currentTarget.dataset.id,o={coupon_type_id:a,action:"take"};util.httpRequest("/coupon/",o,"POST").then(function(e){wx.hideLoading(),"success"===e.result?common.showClickModal("领取成功"):common.showClickModal(e.msg),t.data.info.temp.forEach(function(e){if("shopCoupon"===e.name){var a="/hdh/"+getApp().globalData.acid+"/coupon/?type_ids="+e.data.ids;util.httpRequest(a).then(function(a){e.data.list=a.results;var o=t.data.info;o.temp=t.data.info.temp,t.store({info:o})})}})})}function onBackTop(){common.isscrollToPage(this)}function bindscrollTop(e){common.goTopEvent(this,e.detail.scrollTop)}function formSubmit(e){var t=this.state.layoutForm,a=e.detail.value;a.wx_form_id=e.detail.formId;var o=this;userDefined.submitForm(t,a,function(t){userDefined.reportFuc(t,o.state.page_id,e,o)})}function openWindow(e){var t=e.currentTarget.dataset;t.types="openWindow",common.openUrl(t,this)}function seeBigImg(e){var t=e.currentTarget.dataset.imgurl,a=this.data.list[e.currentTarget.dataset.index].attachments;common.seeBigImg(2,t,a)}function seeImg(){var e=this.data.haiBaoList.original_url;common.seeBigImg(1,e,"")}function housemakePhoneCall(e){var t=e.currentTarget.dataset.index;common.phoneCall(t)}function danpinDetail(e){learn.openDanpinDetail(e)}function userInfoHandler(e){dataTemp.BingUserInfo(this,e)}function pageLoad(e){e.receiveCoupon=receiveCoupon,e.onBackTop=onBackTop,e.bindscrollTop=bindscrollTop,e.formSubmit=formSubmit,e.openWindow=openWindow,e.seeBigImg=seeBigImg,e.seeImg=seeImg,e.housemakePhoneCall=housemakePhoneCall,e.danpinDetail=danpinDetail,e.userInfoHandler=userInfoHandler}function adjustHeightWidth(e,t,a){var o=wx.getSystemInfoSync().windowWidth;return e.then(function(e){return wx.pro.fromSync(function(e){o&&Number(o)>0&&("slideimgs"===a?(t.list.forEach(function(e,a){t.list[a].width&&(t.list[a].width1=t.list[a].width*(Number(o)/320))}),t.height&&(t.height1=t.height*(Number(o)/320))):"but"===a&&(t.height&&(t.height1=t.height*(Number(o)/320)),t.width&&(t.width1=t.width*(Number(o)/320))))})})}function adjustHeight(e,t){var a=wx.getSystemInfoSync().windowWidth;return e.then(function(e){return wx.pro.fromSync(function(e){a&&Number(a)>0&&(t.height1=t.height*(Number(a)/320))})})}function handle(e,t,a,o,n){t.data.hasOwnProperty("display")||(t.data.display="show");var i="",s=n.state.hasLoadCart;switch(t.name){case"community":n.store({joinNumStatue:t.data.join});break;case"activeslist":case"actives":t.data.list.forEach(function(t,o){e[a].data.list[o].clamp2=!0,t.config.showTime&&t.location.desc&&(e[a].data.list[o].clamp2=!1),e[a].data.list[o].pricePos="right",t.config.showTime||t.location.desc||(e[a].data.list[o].pricePos="left")});break;case"fwb":i=WxParse.wxParse("article","html",t.data.con,n,5),n.store(i);break;case"marquee":if(n.store({marquee:t.data}),t.data.con){wx.getSystemInfoSync().windowWidth;wx.createSelectorQuery().select("#txt1").boundingClientRect(function(e){console.log(13.5),n.setData({duration:13.5})}).exec()}break;case"form":e[a].data.focusInputs=[!1,!1,!1,!1],e[a].data.val=["","","",""],n.state.layoutArrIndex=a,n.state.layoutForm=t.data;break;case"video":n.state.videos=wx.createVideoContext("myVideo");break;case"shoplist":case"shop":case"shopGroup":s||(n.state.hasLoadCart=!0,mallList.getCartNum(n));break;case"shopSeck":s||(n.state.hasLoadCart=!0,mallList.getCartNum(n));var r="1col_large";t.data.hasOwnProperty("style")&&(r=t.data.style),n.store({miaoshaStyle:r}),userDefined.getCountDown(t.data.list,n);break;case"imgs":case"window":case"slider":case"slidenav":o=adjustHeight(o,t.data);break;case"slideimgs":case"but":o=adjustHeightWidth(o,t.data,t.name)}}function handle1(e,t){if(e.length<=0)return void wx.hideLoading();var a=wx.pro.fromSync(function(){}),o=[];o=e.length>2?e.slice(0,2):e,o.forEach(function(e,n){handle(o,e,n,a,t)});var n=t.data.info;a.then(function(a){wx.hideLoading(),o.forEach(function(e){n.temp.push(e)}),t.store({info:n}),handle1(e.slice(2,e.length),t)}).catch(function(e){console.log(e)})}function getUserDefined(e){common.commonFun(e),userDefined.getLayout(e,e.state.page_id,function(t){wx.stopPullDownRefresh();var a=e.data.info,o=wx.pro.fromSync(function(){}),n=[];n=t.length>2?t.slice(0,2):t,n.forEach(function(t,a){handle(n,t,a,o,e)});var i=e.data.logoPosBottom;i=!(t.length>0),o.then(function(o){a.temp=n,a.joinNumStatue="show",e.store({info:a,requestStatus:!0,adStatus:!0,logoPosBottom:i}),handle1(t.slice(2,t.length),e)}).catch(function(e){console.log(e)})})}var common=getApp().globalData.commonFun,dataTemp=getApp().globalData.dataTempFun,util=getApp().globalData.utilFun,WxParse=require("../../wxParse/wxParse.js"),userDefined=require("../userDefined/temp/userDefined.js"),mallList=require("../commonPage/mall/shopListTemp.js"),learn=require("../commonPage/zhuanlan/temp.js");module.exports={getUserDefined:getUserDefined,pageLoad:pageLoad};