"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};!function(n,t){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.Ald=t()}(void 0,function(){function n(){this.concurrency=4,this.queue=[],this.tasks=[],this.activeCount=0;var n=this;this.push=function(t){this.tasks.push(new Promise(function(o,e){var a=function(){n.activeCount++,t().then(function(n){o(n)}).then(function(){n.next()})};n.activeCount<n.concurrency?a():n.queue.push(a)}))},this.all=function(){return Promise.all(this.tasks)},this.next=function(){n.activeCount--,n.queue.length>0&&n.queue.shift()()}}function t(n){this.app=n}function o(n){U=""+Date.now()+Math.floor(1e7*Math.random()),B=n,this.aldstat=new t(this)}function e(n){var t;if(t=n.scene!=an,an=n.scene,N=0,B=n,Q=n.query.ald_share_src,G=n.query.aldsrc||"",K=n.query.ald_share_src,L=Date.now(),A=Date.now(),en||(T=""+Date.now()+Math.floor(1e7*Math.random())),!on){j=!1;try{wx.setStorageSync("ald_ifo",!1)}catch(n){}}on=!1,t?k=""+Date.now()+Math.floor(1e7*Math.random()):0!==H&&Date.now()-H>3e4&&(k=""+Date.now()+Math.floor(1e7*Math.random()),A=Date.now()),n.query.ald_share_src&&"1044"==n.scene&&n.shareTicket?wx.getShareInfo({shareTicket:n.shareTicket,success:function(n){W=n,m("event","ald_share_click",JSON.stringify(n))}}):n.query.ald_share_src&&m("event","ald_share_click",1),""===z&&wx.getSetting({withCredentials:!0,success:function(n){n.authSetting["scope.userInfo"]&&wx.getUserInfo({withCredentials:!0,success:function(n){var t=g();z=n,t.ufo=y(n),C=w(n.userInfo.avatarUrl.split("/")),p(t)}})}}),S("app","show")}function a(){H=Date.now(),""===z&&wx.getSetting({success:function(n){n.authSetting["scope.userInfo"]&&wx.getUserInfo({withCredentials:!0,success:function(n){z=n,C=w(n.userInfo.avatarUrl.split("/"));var t=g();t.ufo=y(n),p(t)}})}}),S("app","hide")}function i(n){V++,m("event","ald_error_message",n)}function r(n){nn=n}function s(){Z=this.route,_("page","show")}function c(){$=this.route}function u(){$=this.route}function f(){m("event","ald_pulldownrefresh",1)}function l(){m("event","ald_reachbottom",1)}function h(n){en=!0;var t=v(n.path),o={};for(var e in B.query)"ald_share_src"===e&&(o[e]=B.query[e]);var a="";if(a=-1==n.path.indexOf("?")?n.path+"?":n.path.substr(0,n.path.indexOf("?"))+"?",""!==t)for(var e in t)o[e]=t[e];o.ald_share_src?-1==o.ald_share_src.indexOf(F)&&o.ald_share_src.length<200&&(o.ald_share_src=o.ald_share_src+","+F):o.ald_share_src=F;for(var i in o)-1==i.indexOf("ald")&&(a+=i+"="+o[i]+"&");return n.path=a+"ald_share_src="+o.ald_share_src,m("event","ald_share_status",n),n}function d(){function n(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return n()+n()+n()+n()+n()+n()+n()+n()}function p(n){function t(){return new Promise(function(t,o){wx.request({url:"https://"+I+".aldwx.com/d.html",data:n,header:{AldStat:"MiniApp-Stat",se:O||"",op:E||"",img:C},method:"GET",success:function(n){t(200==n.statusCode?"":"status error")},fail:function(){t("fail")}})})}N++,n.at=T,n.et=Date.now(),n.uu=F,n.v=q,n.ak=R.app_key,n.wsr=B,n.oifo=j,n.rq_c=N,n.ls=U,wx.Queue.push(t)}function g(){var n={};for(var t in X)n[t]=X[t];return n}function w(n){for(var t="",o=0;o<n.length;o++)n[o].length>t.length&&(t=n[o]);return t}function y(n){var t={};for(var o in n)"rawData"!=o&&"errMsg"!=o&&(t[o]=n[o]);return t}function v(n){if(-1==n.indexOf("?"))return"";var t={};return n.split("?")[1].split("&").forEach(function(n){var o=n.split("=")[1];t[n.split("=")[0]]=o}),t}function S(n,t){var o=g();o.ev=n,o.life=t,o.ec=V,o.st=Date.now(),o.ahs=k,G&&(o.qr=G,o.sr=G),Q&&(o.usr=Q),"hide"===t&&(o.hdr=Date.now()-A,o.dr=Date.now()-L,o.ifo=!!j),p(o)}function _(n,t){var o=g();o.ev=n,o.st=Date.now(),o.life=t,o.pp=Z,o.pc=$,o.dr=Date.now()-L,o.ahs=k,en&&(o.so=!0),en=!1,nn&&"{}"!=JSON.stringify(nn)&&(o.ag=nn),G&&(o.qr=G,o.sr=G),Q&&(o.usr=Q),Y||(tn=Z,Y=!0,o.ifp=Y,o.fp=Z),p(o)}function m(n,t,o){var e=g();e.ev=n,e.tp=t,e.st=J,o&&(e.ct=o),p(e)}function x(n,t,o){if(n[t]){var e=n[t];n[t]=function(n){o.call(this,n,t),e.call(this,n)}}else n[t]=function(n){o.call(this,n,t)}}function D(n){var t={};for(var r in n)"onLaunch"!==r&&"onShow"!==r&&"onHide"!==r&&"onError"!==r&&"onPageNotFound"!==r&&"onUnlaunch"!==r&&(t[r]=n[r]);t.onLaunch=function(t){o.call(this,t),"function"==typeof n.onLaunch&&n.onLaunch.call(this,t)},t.onShow=function(t){e.call(this,t),n.onShow&&"function"==typeof n.onShow&&n.onShow.call(this,t)},t.onHide=function(){a.call(this),n.onHide&&"function"==typeof n.onHide&&n.onHide.call(this)},t.onError=function(t){i.call(this,t),n.onError&&"function"==typeof n.onError&&n.onError.call(this,t)},t.onUnlaunch=function(){n.onUnlaunch&&"function"==typeof n.onUnlaunch&&n.onUnlaunch.call(this)},t.onPageNotFound=function(t){n.onPageNotFound&&"function"==typeof n.onPageNotFound&&n.onPageNotFound.call(this,t)},App(t)}function P(n){var t={};for(var o in n)"onLoad"!==o&&"onReady"!==o&&"onShow"!==o&&"onHide"!==o&&"onUnload"!==o&&"onPullDownRefresh"!==o&&"onReachBottom"!==o&&"onShareAppMessage"!==o&&"onPageScroll"!==o&&"onTabItemTap"!==o&&(t[o]=n[o]);t.onLoad=function(t){r.call(this,t),"function"==typeof n.onLoad&&n.onLoad.call(this,t)},t.onShow=function(t){s.call(this),"function"==typeof n.onShow&&n.onShow.call(this,t)},t.onHide=function(t){c.call(this),"function"==typeof n.onHide&&n.onHide.call(this,t)},t.onUnload=function(t){u.call(this),"function"==typeof n.onUnload&&n.onUnload.call(this,t)},t.onReady=function(t){n.onReady&&"function"==typeof n.onReady&&n.onReady.call(this,t)},t.onReachBottom=function(t){l(),n.onReachBottom&&"function"==typeof n.onReachBottom&&n.onReachBottom.call(this,t)},t.onPullDownRefresh=function(t){f(),n.onPullDownRefresh&&"function"==typeof n.onPullDownRefresh&&n.onPullDownRefresh.call(this,t)},t.onPageScroll=function(t){n.onPageScroll&&"function"==typeof n.onPageScroll&&n.onPageScroll.call(this,t)},t.onTabItemTap=function(t){n.onTabItemTap&&"function"==typeof n.onTabItemTap&&n.onTabItemTap.call(this,t)},n.onShareAppMessage&&"function"==typeof n.onShareAppMessage&&(t.onShareAppMessage=function(t){var o=n.onShareAppMessage.call(this,t);return void 0===o?(o={},o.path=this.route):void 0===o.path&&(o.path=this.route),h.call(this,o)}),Page(t)}var b=require("data.js"),M=b.getData().ext?b.getData().ext:wx.getExtConfigSync(),R={};M.hasOwnProperty("ald_config")||(M={ald_config:{app_key:"110fa41ff401825c9c67fa15b6cd86fa",getLocation:0,getUserinfo:0}}),void 0===M.ald_config?(R.appd_key="",R.plugin=!1,R.getLocation=!1):R=M.ald_config,void 0===wx.Queue&&(wx.Queue=new n,wx.Queue.all());var q="7.0.1",I="log",T="",U="",k=Date.now(),A="",L=0,H=0,O="",E="",C="",N=0,B="",j="",F=function(){var n="";try{n=wx.getStorageSync("aldstat_uuid")}catch(t){n="uuid_getstoragesync"}if(n)j=!1;else{n=d(),j=!0;try{wx.setStorageSync("aldstat_uuid",n),wx.setStorageSync("ald_ifo",!0)}catch(n){wx.setStorageSync("aldstat_uuid","uuid_getstoragesync")}}return n}(),J=Date.now(),Q="",G="",K="",V=0,W="",z="",X={},Y=!1,Z="",$="",nn="",tn="",on=!0,en=!1,an="";!function(){wx.request({url:"https://"+I+".aldwx.com/config/app.json",header:{AldStat:"MiniApp-Stat"},method:"GET",success:function(n){200===n.statusCode&&(q<n.data.sanversion&&console.warn("您的SDK不是最新版本，请尽快升级！"),n.data.warn&&console.warn(n.data.warn),n.data.error&&console.error(n.data.error))}})}();try{var rn=wx.getSystemInfoSync();X.br=rn.brand,X.pm=rn.model,X.pr=rn.pixelRatio,X.ww=rn.windowWidth,X.wh=rn.windowHeight,X.lang=rn.language,X.wv=rn.version,X.wvv=rn.platform,X.wsdk=rn.SDKVersion,X.sv=rn.system}catch(n){}return wx.getNetworkType({success:function(n){X.nt=n.networkType}}),wx.getSetting({success:function(n){n.authSetting["scope.userLocation"]?wx.getLocation({type:"wgs84",success:function(n){X.lat=n.latitude,X.lng=n.longitude,X.spd=n.speed}}):R.getLocation&&wx.getLocation({type:"wgs84",success:function(n){X.lat=n.latitude,X.lng=n.longitude,X.spd=n.speed}})}}),t.prototype.sendEvent=function(n,t){if(""!==n&&"string"==typeof n&&n.length<=255)if("string"==typeof t&&t.length<=255)m("event",n,t);else if("object"==(void 0===t?"undefined":_typeof(t))){if(JSON.stringify(t).length>=255)return void console.error("自定义事件参数不能超过255个字符");m("event",n,JSON.stringify(t))}else void 0===t?m("event",n,!1):console.error("事件参数必须为String,Object类型,且参数长度不能超过255个字符");else console.error("事件名称必须为String类型且不能超过255个字符")},t.prototype.sendSession=function(n){if(""===n||!n)return void console.error("请传入从后台获取的session_key");O=n;var t=g();t.st=Date.now(),t.tp="session",t.ct="session",t.ev="event",""===z?wx.getSetting({success:function(n){n.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(n){t.ufo=y(n),C=w(n.userInfo.avatarUrl.split("/")),""!==W&&(t.gid=W),p(t)}}):""!==W&&(t.gid=W,p(t))}}):(t.ufo=z,""!==W&&(t.gid=W),p(t))},t.prototype.sendOpenid=function(n){if(""===n||!n)return void console.error("openID不能为空");E=n;var t=g();t.st=Date.now(),t.tp="openid",t.ev="event",t.ct="openid",p(t)},R.plugin?{App:D,Page:P}:function(n){!function(){var n=App,t=Page;App=function(t){x(t,"onLaunch",o),x(t,"onShow",e),x(t,"onHide",a),x(t,"onError",i),n(t)},Page=function(n){var o=n.onShareAppMessage;x(n,"onLoad",r),x(n,"onUnload",u),x(n,"onShow",s),x(n,"onHide",c),x(n,"onReachBottom",l),x(n,"onPullDownRefresh",f),void 0!==o&&null!==o&&(n.onShareAppMessage=function(n){if(void 0!==o){var t=o.call(this,n);return void 0===t?(t={},t.path=this.route):void 0===t.path&&(t.path=this.route),h(t)}}),t(n)}}()}()});