"use strict";function offTopVal(e){if(wx.createSelectorQuery){var t=wx.createSelectorQuery();t.select("#voteTab").boundingClientRect(),t.selectViewport().scrollOffset(),t.exec(function(t){if(t[0].top>-150)e.fixedTop=Number(2*t[0].top)+150;else{if(0==e.fixedTop)return;e.fixedTop=0}e.setData({fixedTop:e.fixedTop})})}}function voteEvent(e){var t=this,o=e.currentTarget.dataset;if("tab"==o.types){var s=t.data.voteCurrent;if(2==o.index)return t.store({showTypes:!0,voteCurrent:o.index}),void offTopVal(t);if(s==o.index)return;var a=t.data.showTypes;a&&(a=!1),t.store({showTypes:a,voteCurrent:o.index,publishId:0}),t.state.offset=0,wx.showLoading({title:"加载中...",mask:!0}),getVoteList(t,0)}else if("publish"==o.types)wx.navigateTo({url:"/pages/vote/pages/publish/publish"});else if("detail"==o.types){var i=o.id;wx.navigateTo({url:"/pages/vote/pages/voteDetail/voteDetail?id="+i})}else if("type"==o.types){var n=t.data.publishId;if(t.store({publishId:o.publishid,showTypes:!1,isLoading:!0}),n==o.publishid)return;t.state.offset=0,wx.showLoading({title:"加载中...",mask:!0}),getVoteList(t,0)}else if("work"==o.types)wx.navigateTo({url:"/pages/vote/pages/workDetail/workDetail?id="+o.id});else if("delwork"==o.types){console.log("删除")}else if("onBackTop"===o.types)common.isscrollToPage(t);else if("search"==o.types){var l=[{name:"search",data:{placeholder:"搜索",type:"vote"}}];common.setStorage("layout",l),wx.navigateTo({url:"/pages/common/pages/search/search"})}}function getVoteConfig(e,t){util.httpRequest("/vote/ClientConfig/get",{},"GET","v2").then(function(o){if("success"==o.result){var s=common.getStorage("config");s.vote=o.results,common.setStorage("config",s),e.setData({voteConfig:o.results}),t(s)}else common.showClickModal(o.msg)})}function getVoteList(e,t){var o="/vote/VoteActive/get",s={offset:t,limit:e.state.limit};2==e.data.publishId?o="/vote/VoteOptions/get":s.type=e.data.voteCurrent,util.httpRequest(o,s,"GET","v2").then(function(o){if("success"==o.result){var s=common.dataListHandle(e,o,e.data.list,t);e.setData({list:s.list,requestStatus:!0,count:s.count,hasNext:s.hasNext,isLoading:!1})}else common.showClickModal(o.msg);wx.hideLoading()})}function voteShow(e){dataTemp.getBanner(e,"vote"),e.state.offset=0,getVoteList(e,0),getVoteConfig(e,function(t){common.commonFun(e)}),e.voteEvent=voteEvent}function setFunc(e){e.voteEvent=voteEvent}var util=getApp().globalData.utilFun,common=getApp().globalData.commonFun,dataTemp=getApp().globalData.dataTempFun;module.exports={getVoteConfig:getVoteConfig,getVoteList:getVoteList,voteShow:voteShow,offTopVal:offTopVal,voteEvent:voteEvent,setFunc:setFunc};