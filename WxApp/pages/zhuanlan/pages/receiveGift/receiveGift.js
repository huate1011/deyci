"use strict";var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun;Page({data:{interfaceName:"receiveGift",giveDetail:""},state:{pageOnShow:!1},onLoad:function(t){wx.showLoading({title:"加载中...",mask:!0}),this.state.link=t.link,this.state.options=t;var a=this;common.getAccessToken()?(this.getGiveDetail(t.cardId),common.commonFun(this)):getApp().globalData.tokenUpdated=function(){console.log("update success"),a.getGiveDetail(t.cardId),common.commonFun(a)}},onShow:function(){var t=this.state.options;this.state.pageOnShow&&this.getGiveDetail(t.cardId)},store:function(t){this.setData(t)},getGiveDetail:function(t){var a=this,e="/giftcard/"+t+"/";util.httpRequest(e).then(function(t){wx.hideLoading(),a.state.pageOnShow=!0,a.store({giveDetail:t})})},giftCard:function(t){var a=this.data.giveDetail,e={id:a.id,wx_form_id:t.detail.formId};util.httpRequest("/receiveGiftCard/",e,"POST").then(function(t){"success"===t.result?wx.showModal({title:"提示",content:t.msg,showCancel:!1,success:function(t){t.confirm&&wx.navigateTo({url:"/pages/zhuanlan/pages/zhuanlanDetail/zhuanlanDetail?zhuanlanId="+a.objId})}}):common.showClickModal(t.msg)})},toviewDetail:function(){var t=this.data.giveDetail,a=t.product.main_link.split("_"),e=Number(a[1]);wx.navigateTo({url:"/pages/zhuanlan/pages/zhuanlanDetail/zhuanlanDetail?zhuanlanId="+e})}});