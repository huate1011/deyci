"use strict";var util=getApp().globalData.utilFun,common=getApp().globalData.commonFun,yuexpert=require("../../../commonPage/yuexpert/temp.js"),payTempImport=getApp().globalData.payTemp,payEvent=getApp().globalData.payEvent;Page({data:{detail:{},serviceOrderTk:["hide"],reasonValue:""},state:{orderId:0,hasOnshow:!1},onLoad:function(e){wx.showLoading({title:"加载中...",mask:!0}),this.state.options=e,this.state.orderId=e.imd;var t=common.getAccessToken(),a=this;common.payAndBingPhoneSetData(a,function(e){a.setData({payAndBingPhoneStatus:!0})}),t?(common.commonFun(a),common.getWallet(a)):getApp().globalData.tokenUpdated=function(){console.log("update success"),common.commonFun(a),common.getWallet(a)},this.getDetail(e.imd)},onShow:function(){this.state.hasOnshow&&this.getDetail(this.state.orderId)},getDetail:function(e){var t="/api/ExpertToClient/getOrderDetails?id="+e,a=this;util.httpRequest(t,{},"GET","v2").then(function(e){wx.hideLoading(),"success"===e.result?(e.data.youhuiPrice=Number(e.data.OriginalPrice)-Number(e.data.money),a.setData({detail:e.data}),e.data.formValue.forEach(function(e){4===Number(e.typeid)&&(a.state.imgList=e.answer)})):common.showClickModal(e.msg)})},delet:function(e){var t=this,a=this.data.detail;e.id=a.id,e.typeid=30,e.remark="service_zhuanjia_del",common.getFormId(e),yuexpert.deleteOrder(a.id,function(e){if("success"===e.result){var a=t.state.options;a.hasOwnProperty("index")&&getApp().globalData.updateServiceOrderDel(a.index),wx.showModal({title:"提示",content:"删除成功",icon:"success",showCancel:!1,success:function(){wx.navigateBack()}})}else common.showClickModal(e.msg)})},TuiKuanReason:function(e){var t=this,a=this.data.detail;e.id=a.id,e.typeid=30,e.remark="service_zhuanjia_tk",common.getFormId(e),yuexpert.orderRefund(a.id,e.detail.value.reason,function(e){if("success"===e.result){var i=t.state.options;i.hasOwnProperty("index")&&getApp().globalData.updateServiceOrderStatus(i.index),wx.showModal({title:"提示",content:"申请成功",icon:"success",showCancel:!1,success:function(){t.getDetail(a.id);var e=t.data.serviceOrderTk;e[0]="hide",t.setData({serviceOrderTk:e,reasonValue:""})}})}else common.showClickModal(e.msg)})},invTuikuan:function(e){e.id=this.data.detail.id,e.typeid=30,e.remark="service_zhuanjia_tk",common.getFormId(e);var t=this.data.serviceOrderTk;t[0]="show",this.setData({serviceOrderTk:t})},close:function(e){var t=e.currentTarget.dataset.index,a=this.data.serviceOrderTk;a[t]="hide",this.setData({serviceOrderTk:a,reasonValue:""})},evaluate:function(e){this.setData({showPayMethod:!0,useCode:!1,total_money:this.data.detail.money})},payEvent:function(e){payTempImport.payChangeEvent(this,e)},callPayment:function(e,t,a,i){if("wallet"===t)this.setData({payTk:"show",Board:"show"});else{var s={payType:"weixin"};this.submitPay(s)}},walletPay:function(e){this.setData({payTk:"hide"});var t={payType:"wallet",password:this.data.passwords};this.submitPay(t),payEvent.passwordClear(this)},submitPay:function(e){var t=this;e.order_id=this.state.orderId,wx.showLoading({title:"",mask:!0}),payTempImport.wxPayEvent("/api/ServerToClient/pay",e,"v2",function(e,a){if("success"===e){var i=t.state.options;i.hasOwnProperty("index")&&getApp().globalData.updateServiceOrderStatus(i.index),wx.showModal({title:"提示",content:a,icon:"success",showCancel:!1,success:function(){t.getDetail(t.state.orderId)}})}else common.showClickModal(a)})},seeBigImg:function(e){var t=e.currentTarget.dataset.index,a=this.state.imgList;common.seeBigImg(2,a[t],a,"swipers")},score:function(){var e=this.data.detail;common.setStorage("commentImgUrl",e.OrderExp[0].photo.thumb_medium_url),wx.navigateTo({url:"/pages/comment/commentShop/commentShop?id="+e.id+"&type=service$index="+this.state.options.index})}});