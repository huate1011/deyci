"use strict";var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun;Page({data:{list:[],requestStatus:!1,messageDetail:"hide",interfaceName:"message",contactStatus:!0,detail:{},logoPosBottom:!0},state:{offset:0,limit:10,hasmore:!0,isOnReachBottom:!1},onLoad:function(t){wx.showLoading({title:"加载中...",mask:!0}),this.getData(0),common.commonFun(this)},getData:function(t){var e=this,s="/message/?mode=all&offset="+t+"&limit="+this.state.limit;util.httpRequest(s).then(function(s){var a=common.dataListHandle(e,s,e.data.list,t);e.setData({list:a.list,requestStatus:!0,hasNext:a.hasNext})})},onPullDownRefresh:function(){wx.showLoading({title:"加载中...",mask:!0}),this.state.offset=0,this.getData(0)},store:function(t){this.setData(t)},onReachBottom:function(){this.state.isOnReachBottom&&this.state.hasmore&&(wx.showLoading({title:"加载中...",mask:!0}),this.state.offset=this.state.offset+this.state.limit,this.getData(this.state.offset),this.state.isOnReachBottom=!1)},clear:function(){var t=this;wx.showLoading({title:"清除中...",mask:!0});util.httpRequest("/message/delete/",{},"PUT").then(function(e){wx.hideLoading(),t.state.offset=0,t.store({list:[]}),common.showClickModal("清除成功")}).catch(function(t){common.showClickModal(t.resMsg),wx.hideLoading()})},openMessageDetail:function(t){var e=t.currentTarget.dataset.id,s=t.currentTarget.dataset.index;this.state.indexof=s;var a=this.data.list,i=this;wx.showLoading({title:"加载中...",mask:!0});var o="/message/"+e+"/";util.httpRequest(o).then(function(t){wx.hideLoading(),a[s].status="read",i.store({detail:t,messageDetail:"show",list:a}),wx.pro.request({url:"/message/"+e+"/read/",method:"PUT"})})},closemessageDetail:function(){this.store({messageDetail:"hide"})},deteleMessage:function(t){var e=this,s=t.currentTarget.dataset.id,a=this.data.list,i=this.state.indexof;wx.showLoading({title:"删除中...",mask:!0});var o="/message/"+s+"/delete/";util.httpRequest(o,{},"PUT").then(function(t){wx.hideLoading(),common.showClickModal("删除成功"),e.closemessageDetail(),a.splice(i,1),e.store({list:a})}).catch(function(t){common.showClickModal(t.resMsg),wx.hideLoading()})}});