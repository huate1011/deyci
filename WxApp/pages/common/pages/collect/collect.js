"use strict";var util=getApp().globalData.utilFun,common=getApp().globalData.commonFun;Page({data:{list:[],logoPosBottom:!0,contactStatus:!0,requestStatus:!1,isPageScrollTo:!1,showGoTop:!1,current:0,peise:getApp().globalData.peise,nav:[]},state:{pageShow:!1,offset:0,limit:10,hasmore:!0,isOnReachBottom:!1,typeArr:[]},onLoad:function(){var t=this;wx.showLoading({title:"加载中...",mask:!0}),common.getConfig(function(e){common.commonFun(t),console.log(e.modules);var a=[],s=[];e.modules.activity&&(a.push("activity"),s.push("活动票务")),e.modules.news&&(a.push("news"),s.push("新闻资讯")),e.modules.mall&&(a.push("shop"),s.push("微商城")),e.modules.learn&&(a.push("column"),s.push("专栏"),a.push("danpin"),s.push("单品")),e.modules.sameCity&&(a.push("catalog"),s.push("同城生活")),e.modules.business&&(a.push("settle"),s.push("商家入驻")),t.state.typeArr=a,t.setData({nav:s}),t.getData(0)})},getData:function(t){var e=this,a="/collect/?offset="+t+"&limit="+this.state.limit+"&type="+this.state.typeArr[this.data.current];util.httpRequest(a).then(function(a){var s=common.dataListHandle(e,a,e.data.list,t);e.setData({list:s.list,requestStatus:!0,hasNext:s.hasNext}),e.state.pageShow=!0,wx.hideLoading()})},onShow:function(){var t=this;getApp().globalData.updateCollectList=function(e){var a=t.data.list;a.splice(e,1),t.setData({list:a})}},openDetail:function(t){var e=t.currentTarget.dataset.index,a=this.data.list;"news"===a[e].typeTxt&&(t.typeid=3,t.remark="news_detail",wx.navigateTo({url:"/pages/newMovement/pages/newsDetail/newsDetail?collect=true&newsId="+a[e].id+"&index="+e})),"activity"===a[e].typeTxt&&(t.typeid=1,t.remark="activity_detail",wx.navigateTo({url:"/pages/activity/pages/activityDetail/activityDetail?isODOpen=0&id="+a[e].id+"&index="+e})),"shop"===a[e].typeTxt&&(t.typeid=8,t.remark="shop_detail",wx.navigateTo({url:"/pages/mall/pages/shopDetail/shopDetail?isMallODOpen=0&productId="+a[e].id+"&index="+e})),"column"===a[e].typeTxt&&(t.typeid=8,t.remark="shop_detail",wx.navigateTo({url:"/pages/zhuanlan/pages/zhuanlanDetail/zhuanlanDetail?zhuanlanId="+a[e].id+"&collectIndex="+e})),"danpin"===a[e].typeTxt&&(t.typeid=8,t.remark="danpin_detail",4===Number(a[e].classId)&&wx.navigateTo({url:"/pages/zhuanlan/pages/danpinAudeoDetail/danpinAudeoDetail?danpinId="+a[e].id+"&collectIndex="+e}),5===Number(a[e].classId)&&wx.navigateTo({url:"/pages/zhuanlan/pages/danpinVideoDetail/danpinVideoDetail?danpinId="+a[e].id+"&collectIndex="+e}),6===Number(a[e].classId)&&wx.navigateTo({url:"/pages/zhuanlan/pages/danpinTuwenDetail/danpinTuwenDetail?danpinId="+a[e].id+"&collectIndex="+e})),"house"===a[e].typeTxt&&(t.typeid=31,t.remark="house_detail",wx.navigateTo({url:"/pages/house/pages/detail/detail?id="+a[e].id+"&collectIndex="+e})),"catalog"===a[e].typeTxt&&(t.typeid=14,t.remark="house_detail",wx.navigateTo({url:"/pages/sameCity/pages/detail/detail?id="+a[e].id+"&collectIndex="+e})),"settle"===a[e].typeTxt&&(t.typeid=28,t.remark="settle_detail",wx.navigateTo({url:"/pages/settleIn/pages/storeDetail/storeDetail?id="+a[e].id+"&collectIndex="+e})),t.id=a[e].id,common.getFormId(t)},navEvent:function(t){var e=t.currentTarget.dataset.index;Number(this.data.current)!==Number(e)&&(this.store({current:e,list:[],requestStatus:!1}),wx.showLoading({title:"加载中...",mask:!0}),this.state.offset=0,this.getData(0))},store:function(t){this.setData(t)},onBackTop:function(){common.isscrollToPage(this)},onPageScroll:function(t){common.goTopEvent(this,t.scrollTop),common.scrollIsTabFixed(this,t)},onPullDownRefresh:function(){this.state.isonPullDownRefresh=!0,wx.showLoading({title:"加载中...",mask:!0}),this.state.offset=0,this.getData(0)},onReachBottom:function(){this.state.isonPullDownRefresh||this.state.isOnReachBottom&&this.state.hasmore&&(wx.showLoading({title:"加载中...",mask:!0}),this.state.offset=this.state.offset+this.state.limit,this.getData(this.state.offset),this.state.isOnReachBottom=!1)}});