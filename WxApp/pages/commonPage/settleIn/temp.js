"use strict";function _defineProperty(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function getConfig(t,e){util.httpRequest("/business/ServerConfig/get",{},"GET","v2").then(function(s){if("success"===s.result){var a=common.getStorage("config");a.settle=s.results,common.setStorage("config",a),t.store({config:a,busConfig:s.results,peise:getApp().globalData.peise}),e(a)}})}function getBusinessList(t,e,s){var a={status:s,offset:e,limit:t.state.limit};"不限"!=t.data.cityName&&(a.city=t.data.cityName),util.httpRequest("/business/business/pageData",a,"GET","v2").then(function(s){if(wx.hideLoading(),"success"===s.result){var a=common.dataListHandle(t,s,t.data.list,e);t.store({requestStatus:!0,list:a.list,hasNext:a.hasNext})}else common.showClickModal(s.msg)})}function getClassBusinesslist(t,e,s){var a={offset:e,limit:t.state.limit,classId:t.state.classId};s&&(a.status=s),t.state.options.hasOwnProperty("city")&&(a.city=t.state.options.city),util.httpRequest("/business/business/pageData",a,"GET","v2").then(function(s){if(wx.hideLoading(),"success"===s.result){var a=common.dataListHandle(t,s,t.data.list,e);t.store({requestStatus:!0,list:a.list,hasNext:a.hasNext})}else common.showClickModal(s.msg)})}function getSelected(t){return util.httpRequest("/business/business/pageData",{status:10},"GET","v2").then(function(e){"success"===e.result?t.store({featured:e.results}):common.showClickModal(e.msg)}).then(function(){getBusinessList(t,0,t.data.sortIdx)})}function getClassList(t){return util.httpRequest("/business/Information/category?pid=0",{},"GET","v2").then(function(e){if(getSelected(t),"success"===e.result){for(var s=[],a=[],i=0;i<e.results.length;i+=1)a.push(e.results[i]),8!==a.length&&i!==e.results.length-1||(s.push(a),a=[]);t.store({typeName:s})}else common.showClickModal(e.msg)})}function getDetail(t,e,s){var a=t.data.list;if(a[s]){var i="/business/Information/showOne?id="+e;util.httpRequest(i,{},"GET","v2").then(function(e){if("success"===e.result){var i=e.results;a[s].businessName=i.businessName,a[s].logo=i.logo,a[s].service=i.service,a[s].address=i.address,a[s].views=i.views,a[s].comments=i.comments,t.setData({list:a})}})}}function showLoadEvent(t){getApp().globalData.settleUpdateCallback=function(e,s){var a=t.data.list;s?(a[e].businessName=s.businessName,a[e].logo=s.logo,a[e].service=s.service,a[e].address=s.address,a[e].views=s.views,a[e].comments=s.comments,t.setData({list:a})):getDetail(t,a[e].id,e)},getApp().globalData.settleDeleteCallback=function(e){var s=t.data.list;s.splice(e,1),t.setData({list:s})},getApp().globalData.settlePublishCallback=function(){t.state.offset=0,t.setData({list:[],sortIdx:1}),getBusinessList(t,0,1),common.isscrollToPage(t)},getApp().globalData.updateAddress=function(e){t.state.offset=0;var s=t.data.cityName;console.log(e),s="不限"==e?e:e.name,t.setData({list:[],sortIdx:1,cityName:s}),getBusinessList(t,0,1),common.isscrollToPage(t)}}function settleEvent(t){var e=this,s=t.currentTarget.dataset;if("sort"===s.types){if(Number(e.data.sortIdx)===Number(s.index))return;e.store({sortIdx:s.index}),wx.showLoading({title:"加载中...",mask:!0}),e.state.offset=0,5===Number(s.index)?common.currentLocation(0,function(t){console.log(t),e.state.lat=t.latitude,e.state.lng=t.longitude,common.setStorage("position",{lat:t.latitude,lng:t.longitude}),e.state.classId?getClassBusinesslist(e,0,s.index):getBusinessList(e,0,s.index)}):e.state.classId?getClassBusinesslist(e,0,s.index):getBusinessList(e,0,s.index)}else if("detail"===s.types){var a=s.id;wx.navigateTo({url:"/pages/settleIn/pages/storeDetail/storeDetail?id="+a+"&index="+s.index})}else if("search"===s.types){var i=[{name:"search",data:{placeholder:"搜索",type:"settle"}}];common.setStorage("layout",i),wx.navigateTo({url:"/pages/common/pages/search/search"})}else if("class"===s.types){var o=s.item;if(o.subClass.length>0){var n={id:o.id,name:"全部"};o.subClass.unshift(n);var l=e.data.showSub;l[0]="show",e.store({subList:o.subClass,showSub:l})}else wx.navigateTo({url:"/pages/settleIn/pages/list/list?id="+o.id+"&city="+e.data.cityName})}else if("subClass"===s.types){var u=s.id,r=e.data.showSub;r[0]="hide",e.store({showSub:r}),wx.navigateTo({url:"/pages/settleIn/pages/list/list?id="+u+"&city="+e.data.cityName})}else if("close"===s.types){var c=s.index,d=e.data.showSub;d[c]="hide",e.store({showSub:d})}else if("onBackTop"===s.types)common.isscrollToPage(e);else if("city"===s.types)wx.navigateTo({url:"/pages/common/pages/city/city"});else if("publishBtn"===s.types){var g=e.data.showSub;g[1]="show",e.store({showSub:g})}else if("publish"===s.types){var m=s.key,p=e.data.showSub;p[1]="hide",e.store({showSub:p});var f="/pages/settleIn/pages/information/information";"goods"===m&&(f="/pages/settleIn/pages/publishGoods/publishGoods"),wx.navigateTo({url:f})}}function showLoad(t){dataTemp.getBanner(t,"settle"),getClassList(t),getConfig(t,function(e){common.commonFun(t)}),t.settleEvent=settleEvent,wx.getLocation({type:"wgs84",success:function(e){console.log(e),common.conversionAddress(e.latitude,e.longitude,function(e){var s=t.data.cityName;s&&"定位失败"!=s||(s="不限"),t.setData({cityName:s,requestStatus:!0})})}})}function listShowLoad(t){t.settleEvent=settleEvent,wx.getLocation({type:"wgs84",success:function(e){console.log(e),common.conversionAddress(e.latitude,e.longitude,function(e){t.setData({cityName:e.result.address_component.city,requestStatus:!0})})}})}function settleDataSet(t){var e;t.setData((e={banner:[],typeName:[],sortIdx:1,featured:[],list:[],subList:[],hasNext:!0,showGoTop:!1,showSub:["hide","hide"],peise:getApp().globalData.peise,requestStatus:!1,alterRequestStatus:!0},_defineProperty(e,"requestStatus",!1),_defineProperty(e,"logoPosBottom",!0),_defineProperty(e,"cityName","定位失败"),e)),t.settleEvent=settleEvent}var util=getApp().globalData.utilFun,common=getApp().globalData.commonFun,dataTemp=getApp().globalData.dataTempFun;module.exports={getConfig:getConfig,getClassList:getClassList,getBusinessList:getBusinessList,getClassBusinesslist:getClassBusinesslist,getSelected:getSelected,settleEvent:settleEvent,showLoad:showLoad,listShowLoad:listShowLoad,showLoadEvent:showLoadEvent,settleDataSet:settleDataSet};