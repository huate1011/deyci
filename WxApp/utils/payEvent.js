"use strict";function passwordDelete(a){var t=a.data.passwordLength,e=a.data.showPassword,o=a.data.passwords;t>0&&(t-=1,e[t]="",o=o.substr(0,t),a.setData({showPassword:e,passwords:o,passwordLength:t}))}function passwordClear(a){a.setData({passwords:"",showPassword:["","","","","",""],passwordLength:0})}function chooseType(a,t){var e=a.currentTarget.dataset,o=Number(e.index),s=t.data.payMethod,r=t.data.cash_balance,d=t.data.total_money;if("success"!==s[o]){if(1===o&&Number(r)<Number(d))return void common.showClickModal("账户余额不足");if(!t.data.isSetPayPassword)return wx.hideLoading(),void wx.showModal({title:"提示",content:"请先设置支付密码",success:function(a){if(a.confirm){var e=t.data.tankuang;e[2]="show",t.setData({tankuang:e})}}});s.forEach(function(a,t){s[t]="circle"}),s[o]="success",t.setData({payMethod:s,payId:o})}}function calculatePrice(a,t){var e=a.data.tgDataDetail,o=a.data.convertible;if(e.skus){var s={cartsku:[{sku_id:e.skus[0].id,count:a.data.isGift?a.data.giveNum:1,normal_product:!0,isMemberProduct:a.data.detail.isMemberLearn}],module:"learn",types:a.state.pageName,id:a.state.learnId};a.data.isGift?s.from="gift":s.coupon_id=t;util.httpRequest("/order/price/",s,"POST").then(function(t){var e=a.data.detail,s=t.order.price.discount;0!==t.order.price.total_price||a.data.coupon||(o=!1),a.setData({convertible:o,discount:s,detail:e,total_money:t.order.price.total_price})})}}function getCoupon(a,t){wx.showLoading({title:"",mask:!0});var e=a.state.pageName,o={redeem_code:t,action:"take",product_id:a.data.detail.fee_product_id};util.httpRequest("/coupon/",o,"POST").then(function(t){if(wx.hideLoading(),"fail"===t.result)return void common.showClickModal(t.msg);"shop"===e?a.calculateOrderPrice():calculatePrice(a,t.coupon.id),a.setData({coupon:t.coupon,selectedCoupon:t.coupon})})}var util=require("util.js"),common=require("common.js");module.exports={passwordDelete:passwordDelete,passwordClear:passwordClear,chooseType:chooseType,getCoupon:getCoupon};