"use strict";function getSignInData(t){util.httpRequest("/api/signIn/glist",{},"GET","v2").then(function(e){"fail"===e.result&&(e.data={my:{status:1}}),t(e)})}function ImgLoad(t){var e=t.currentTarget.dataset,a=this.data.banner;a[e.index].height=Number(t.detail.height),this.setData({banner:a})}function getBanner(t,e){var a="/hdh/"+getApp().globalData.acid+"/ads/?type="+e;util.httpRequest(a).then(function(e){t.setData({banner:e.results})}),t.ImgLoad=ImgLoad}function getgg(t,e,a,o,n){var s="/api/notice/GetNotice?typeId="+e+"&applyId="+a;util.httpRequest(s,{},"GET","v2").then(function(t){n(t)})}function seeAlbum(t){Number(t.total)>0?wx.navigateTo({url:"/pages/album/pages/photoDetailList/photoDetailList?albumId="+t.id}):wx.showModal({title:"提示",content:"该相册还未上传照片",showCancel:!1,confirmText:"关闭"})}function albumList(t,e){var a=wx.getSystemInfoSync().windowWidth,o="/hdh/"+getApp().globalData.acid+"/album/?offset="+e+"&limit=10";util.httpRequest(o).then(function(o){var n=common.dataListHandle(t,o,t.data.list,e);t.store({list:n.list,view_type:common.getStorage("config").album.list_view_type,windowHeight:.6*Number(a),requestStatus:!0}),wx.stopPullDownRefresh()})}function albumEvent(t){albumChangeEvent(this,t)}function albumConfig(t){t.albumEvent=albumEvent,common.configData("album",function(){common.commonFun(t);var e=common.getStorage("config").album;e.module?albumList(t,0):common.showClickModal(e.msg)})}function scrolltolower(t){t.state.isOnReachBottom&&t.state.hasmore&&(wx.showLoading({title:"加载中...",mask:!0}),t.state.offset+=t.state.limit,albumList(t,t.state.offset),t.state.isOnReachBottom=!1)}function albumChangeEvent(t,e){var a=e.currentTarget.dataset;"viewBigImg"===a.types?seeAlbum(a):"scrolltolower"===a.types&&scrolltolower(t)}function aboutEvent(t){aboutChangeEvent(this,t)}function showAbuotInfo(t){t.aboutEvent=aboutEvent;var e=t.data.info,a="/hdh/"+getApp().globalData.acid+"/";util.httpRequest(a).then(function(a){wx.hideLoading(),wx.stopPullDownRefresh(),e.about=a,t.setData({info:e,logoPosBottom:!1,contactStatus:!0}),common.commonFun(t),t.state.pageOnShow=!0})}function aboutChangeEvent(t,e){var a=e.currentTarget.dataset;if("call"===a.types)common.phoneCall(a.phone);else if("location"===a.types)common.openMap(a.lat,a.lng);else if("kefu"===a.types)t.setData({tankuang:"show"});else if("close"===a.types)t.setData({tankuang:"hide"});else if("seeyyzz"===a.types)common.seeBigImg(1,t.imgurl,"");else if("photos"===a.types){var o=t.data.info.about.photos,n=t.data.info.about.photos[a.index].original_url;common.seeBigImg(2,n,o)}else"wxkf"===a.types&&common.seeBigImg(1,a.imgurl,"")}function perCenterMenu(t){util.httpRequest("/hdh/perCenterMenu/").then(function(e){if(wx.hideLoading(),"success"===e.result){var a=t.data.menuList;a.hasOwnProperty("list")&&e.results.list.forEach(function(t,e){t.show=a.list[e].show}),t.setData({menuList:e.results,menuStatus:!0})}else common.showClickModal(e.message)})}function myEvent(t){myEventChange(this,t)}function userInfoHandler(t){BingUserInfo(this,t)}function showGetUserInfo(t){t.myEvent=myEvent,t.userInfoHandler=userInfoHandler,common.getPersonInfo().then(function(e){t.setData({myInfo:e,logoPosBottom:!1,contactStatus:!0}),common.commonFun(t),t.state.pageOnShow=!0,common.getWallet(t),perCenterMenu(t),wx.stopPullDownRefresh()})}function myEventChange(t,e){var a=e.currentTarget.dataset.index,o=t.data.menuList,n=o.list[a].show;o.list.forEach(function(t){t.show=!1}),o.list[a].show=!n,t.setData({menuList:o})}function BingUserInfo(t,e){console.log(e);var a=e.detail;if(a.hasOwnProperty("userInfo")){var o={displayname:a.userInfo.nickName,avatar_url:{original_url:a.userInfo.avatarUrl}};wx.showLoading({title:"绑定中...",mask:!0}),t.setData({auth:["hide"]});util.httpRequest("/user/me/",o,"POST").then(function(e){if(wx.hideLoading(),"success"===e.result){var o=t.data.myInfo;o.displayname=a.userInfo.nickName,o.avatar_url.thumb_medium_url=a.userInfo.avatarUrl,o.avatar_url.thumb_small_url=a.userInfo.avatarUrl,common.setStorage("userInfo",o),t.setData({myInfo:o}),common.showClickModal("个人信息绑定成功")}else common.showClickModal("修改失败")})}}function newMovementList(t,e){var a="";t.state.keywords&&(a="&q="+t.state.keywords);var o="/hdh/"+getApp().globalData.acid+"/news/?order=recent&style="+common.getStorage("config").news.list_view_type+"&offset="+e+"&limit="+t.state.limit+"&category_id="+t.state.categoryid+a;util.httpRequest(o,a).then(function(a){a.count>0&&a.results.forEach(function(t,e){a.results[e].hasOwnProperty("info")&&(a.results[e].info.length>60?a.results[e].isMore=!0:a.results[e].isMore=!1)});var o=common.dataListHandle(t,a,t.data.list,e),n=!1;0===o.list.length&&(n=!0),t.setData({list:o.list,hasNext:o.hasNext,listDataType:"news",requestStatus:!0,logoPosBottom:n})})}function openDetail(t){var e=t.currentTarget.dataset.index,a=this.data.list;t.id=a[e].id,t.typeid=3,t.remark="news_detail",common.getFormId(t),wx.navigateTo({url:"/pages/newMovement/pages/newsDetail/newsDetail?newsId="+a[e].id+"&index="+e})}function newsData(t){t.openDetail=openDetail;var e=common.getStorage("config"),a=t.data.info,o="/hdh/"+getApp().globalData.acid+"/ads/?type=news";util.httpRequest(o).then(function(o){wx.stopPullDownRefresh();var n=getApp().globalData.newscategoryId,s=e.news.categories,i=t.state.options;s.length>0?0!==Number(n)||i.hasOwnProperty("category_id")?(i.hasOwnProperty("category_id")?t.state.categoryid=i.category_id:t.state.categoryid=n,s.forEach(function(e,o){Number(e.id===Number(t.state.categoryid))&&(a.activeIndex=o,a.toView="category_"+o)})):t.state.categoryid=s[0].id:(wx.hideLoading(),i.hasOwnProperty("category_id")?t.state.categoryid=i.category_id:t.state.categoryid=n),t.store({info:a,contactStatus:!0,logoPosBottom:!0,navList:e.news.categories,banner:o.results,newsIssearch:e.news.issearch,news_list_view_type:e.news.list_view_type}),t.state.offset=0,getApp().globalData.newscategoryId=0,t.state.options={},newMovementList(t,0),common.updateTabOffsetTop(t)})}function seeBigImg(t){var e=t.currentTarget.dataset.imgurl,a=this.data.list[t.currentTarget.dataset.index].attachments;common.seeBigImg(2,e,a)}function newsEvent(t){newsChangeEvent(this,t)}function onBackTop(){common.isscrollToPage(this)}function hideIcon(){this.store({iconStatus:!1})}function newsBlurInput(t){var e=t.detail.value;common.isNull(e)&&this.store({iconStatus:!0})}function newsNavList(t){t.seeBigImg=seeBigImg,t.newsEvent=newsEvent,t.onTapTag=onTapTag,t.onBackTop=onBackTop,t.hideIcon=hideIcon,t.newsBlurInput=newsBlurInput,t.openDetail=openDetail,common.configData("news",function(){common.commonFun(t);var e=common.getStorage("config").news;e.module?newsData(t):common.showClickModal(e.msg)})}function newsLike(t,e){wx.showLoading({title:"",mask:!0});var a=e.data.list,o=t.id,n=t.index,s=t.method,i="/news/"+o+"/like/";"DELETE"===s&&(i="/news/"+o+"/like/delete/"),util.httpRequest(i,{},"PUT").then(function(t){wx.hideLoading(),"success"===t.result?("DELETE"===s?(a[n].like_count-=1,a[n].is_like=!1):(a[n].like_count+=1,a[n].is_like=!0),e.store({list:a})):common.showClickModal(t.msg)})}function getNewsDetail(t,e,a){var o="/news/"+e+"/",n=t.data.list;util.httpRequest(o).then(function(e){n[a].comment_count=e.comment_count,n[a].like_count=e.like_count,n[a].views=e.views,t.store({list:n})})}function showMoreData(t,e){var a=t.data.list;a[e.index].isMore=!1,t.setData({list:a})}function hideMoreData(t,e){var a=t.data.list;a[e.index].isMore=!0,t.setData({list:a})}function newsChangeEvent(t,e){var a=e.currentTarget.dataset;if("zhankaiMore"===a.types)showMoreData(t,a);else if("yincangMore"===a.types)hideMoreData(t,a);else if("newsLiken"===a.types)common.wxAuthorize(t,function(e){e&&newsLike(a,t)});else if("close"===a.types)t.setData({tankuang:"hide"});else if("seeyyzz"===a.types)common.seeBigImg(1,t.imgurl,"");else if("photos"===a.types){var o=t.data.info.about.photos,n=t.data.info.about.photos[a.index].original_url;common.seeBigImg(2,n,o)}else if("newsSearchBtn"===a.types||"submitNewsSearchBtn"===a.types){var s="newsSearchBtn"===a.types?e.detail.value:e.detail.value.keyword;if(""===s||!s)return void common.showClickModal("请输入关键字");t.state.keywords=s,t.state.offset=0;var i=t.data.info;i.activeIndex=0,i.toView="category_0",t.store({info:i}),newMovementList(t,0)}}function actList(t,e){var a="/hdh/"+getApp().globalData.acid+"/activity/?category_id="+e.state.categoryid+"&offset="+t+"&limit="+e.state.limit;util.httpRequest(a).then(function(a){wx.stopPullDownRefresh();var o=common.dataListHandle(e,a,e.data.list,t);o.list.forEach(function(t,e){o.list[e].pricePos="right",t.config.showTime||t.location.desc||(o.list[e].pricePos="left")});var n=!1;0===o.list.length&&(n=!0),e.setData({list:o.list,requestStatus:!0,hasNext:o.hasNext,logoPosBottom:n}),wx.hideLoading()})}function typeData(t){var e=common.getStorage("config").activity,a=t.data.info;a.temp_name=e.list_view_type,a.list_order_type=e.list_order_type;var o=getApp().globalData.hdcategoryId,n=e.categories,s=t.state.options;n.length>0?t.state.isRefresh||(0!==Number(o)||s.hasOwnProperty("category_id")?(s.hasOwnProperty("category_id")?t.state.categoryid=s.category_id:t.state.categoryid=o,n.forEach(function(e,o){Number(e.id===Number(t.state.categoryid))&&(a.activeIndex=o,a.toView="category_"+o)})):t.state.categoryid=n[0].id):(wx.hideLoading(),s.hasOwnProperty("category_id")?t.state.categoryid=s.category_id:t.state.categoryid=o),t.store({info:a,navList:e.categories,listDataType:"activity"}),t.state.offset=0,getApp().globalData.hdcategoryId=0,t.state.isRefresh=!1,t.state.options={},common.getAccessToken()?actList(0,t):getApp().globalData.tokenUpdated=function(){console.log("update success"),actList(0,t)},getBanner(t,"activity")}function onTapTag(t){var e=this,a=t.currentTarget.dataset.id,o=t.currentTarget.dataset.index,n=t.currentTarget.dataset.type,s=e.data.info;e.state.hasmore=!0,e.state.offset=0,s.activeIndex!==o&&(s.activeIndex=o,s.toView="category_"+o,e.state.categoryid=a,e.state.offset=0,e.setData({info:s,searchVal:"",list:[],requestStatus:!1}),wx.showLoading({title:"加载中...",mask:!0}),"activity"===n?actList(0,e):"news"===n&&(e.state.keywords="",newMovementList(e,0)))}function activityType(t){t.onTapTag=onTapTag,common.configData("activity",function(){common.commonFun(t);var e=common.getStorage("config").activity;e.module?typeData(t):common.showClickModal(e.msg)})}function dianzan(t,e,a){wx.showLoading({title:"",mask:!0}),util.httpRequest(e,{},"PUT").then(function(e){if(wx.hideLoading(),"success"===e.result){var o=t.data.detail;"DELETE"===a?(o.like_count-=1,o.is_like=!1):(o.like_count+=1,o.is_like=!0),Number(o.like_count)<=10&&t.getLikeList(),t.store({detail:o})}else common.showClickModal(e.msg)})}function dianzanList(t,e){var a=t.data.detail;util.httpRequest(e).then(function(e){a.like_count=e.count;var o="";e.results.forEach(function(t){o+=""===o?t.displayname:","+t.displayname}),t.store({dianzanInfo:e.results,likeName:o,detail:a}),wx.hideLoading()})}function pinglunList(t,e,a){util.httpRequest(e).then(function(e){var o=common.dataListHandle(t,e,t.data.commentInfo,a);o.list.forEach(function(t,e){var a=[];if(t.rating){for(var n=1;n<=5;n+=1)t.rating/2>=n?a.push("https://www.haojian.cn/wximg/mall/star_act.png"):a.push("https://www.haojian.cn/wximg/mall/star_def.png");o.list[e].grade=a}}),t.store({commentInfo:o.list})})}function pinglun(t,e,a,o){var n=t.data.detail,s=a.detail.value.pinglun;if(common.isNull(s))return void common.showTimeToast("请输入评论内容");wx.showLoading({title:"",mask:!0});var i={wx_form_id:a.detail.formId,content:s,type:a.p_type,did:a.did};util.httpRequest(e,i,"POST").then(function(e){wx.hideLoading(),"fail"===e.result?common.showClickModal(e.msg):("wait_confirm"===e.comment.status?common.showClickModal("评论已提交，等待审核！"):(t.getComment(0),n.comment_count+=1),t.store({detail:n,contentVal:""}),"sameCity"===o&&t.setData({bottom:["show","hide"]}))})}function submitHuifu(t,e,a){var o=common.getStorage("userInfo").id;t.state.huifuId=a.currentTarget.dataset.uid;var n=a.currentTarget.dataset.uname,s=a.currentTarget.dataset.commentid;t.state.commentId=s;var i=["回复"];Number(t.state.huifuId)===o&&(i=["删除"]),wx.showActionSheet({itemList:i,itemColor:"#333333",success:function(s){if("匿名"===n)return void common.showClickModal("匿名评论不能回复！");0===s.tapIndex&&(Number(t.state.huifuId)===o?util.httpRequest(e,{},"PUT").then(function(){var e=t.data.detail;e.comment_count-=1,t.setData({detail:e}),t.state.offset=0,t.getComment(0)}):("sameCity"===a.pageName&&t.setData({bottom:["hide","show"]}),t.store({showInput:"show",isFocus:!0,placeholderVal:"回复"+n+"：",contentVal:"",is_reply:!0})))},fail:function(e){"newsDetail"===a.pageType&&t.setData({showInput:"hide"}),console.log(e.errMsg)}})}function huifuPinglun(t,e,a){common.getStorage("userInfo")?submitHuifu(t,e,a):common.getPersonInfo().then(function(o){submitHuifu(t,e,a)})}function subReply(t,e,a){var o=a.detail.value.pinglun;if(common.isNull(o))return void common.showTimeToast("请输入回复内容！");if(!t.state.huifuId)return void common.showClickModal("请选择要回复的评论！");wx.showLoading({title:"",mask:!0});var n={wx_form_id:a.detail.formId,content:o,ref_uid:t.state.huifuId};util.httpRequest(e,n,"POST").then(function(e){if(wx.hideLoading(),"fail"===e.result)common.showClickModal(e.msg);else{if("wait_confirm"===e.comment.status)common.showClickModal("回复成功，等待审核！");else{t.state.offset=0;var a=t.data.detail;a.comment_count+=1,t.getComment(0,a)}t.store({is_reply:!1,contentVal:"",isFocus:!1,showInput:"hide",placeholderVal:"输入评论内容..."})}})}function getShequnConfig(t){common.configData("shequn",function(e){common.commonFun(t),e.shequn.module?(getShequnData(t,0),t.setData({config:e.shequn})):(common.showClickModal(e.shequn.msg),wx.hideLoading())})}function getShequnData(t,e){var a="/hdh/"+getApp().globalData.acid+"/community/?offset="+e+"&limit="+t.state.limit;util.httpRequest(a).then(function(a){var o=common.dataListHandle(t,a,t.data.list,e);t.setData({list:o.list,joinNumStatue:"show",requestStatus:!0}),wx.stopPullDownRefresh(),getBanner(t,"community")})}function shequnDetail(t,e){var a=t.data.list;if(a[e]){var o="/community/detail/"+a[e].id+"/";util.httpRequest(o).then(function(o){a[e].is_member=o.results.is_member,a[e].member_count=o.results.member_count,a[e].thread_count=o.results.thread_count,t.setData({list:a})})}}function searchSettle(t,e,a){var o="/business/business/pageData?offset="+t+"&limit="+a.state.limit;util.httpRequest(o,{status:4,name:e.q},"GET","v2").then(function(t){if(wx.hideLoading(),"success"===t.result){var e=a.data.list;e=0===a.state.offset?t.results:e.concat(t.results);0===t.next&&!1,a.setData({list:e}),a.state.nextCount=t.next}else common.showClickModal(t.msg)})}function searchVote(t,e,a){var o="/vote/VoteActive/get?offset="+t+"&limit="+a.state.limit;util.httpRequest(o,{theme:e.q},"GET","v2").then(function(t){if(wx.hideLoading(),"success"==t.result){var e=a.data.list;e=0===a.state.offset?t.results:e.concat(t.results);var o=!0;0===t.next&&(o=!1),a.setData({list:e,hasNext:o}),a.state.nextCount=t.next}else common.showClickModal(t.msg)})}function searchActivity(t,e,a){common.commonFun(a);var o=a.data.list;"product"===e.types?o=a.data.mall:"column"===e.types&&(o=a.data.info),wx.showLoading({title:"加载中..."});var n=getApp().globalData.acid,s="/hdh/"+n+"/"+e.types+"/?offset="+t+"&limit="+a.state.limit;"restaurant"==e.types&&(s="/restaurant/?offset="+t+"&limit="+a.state.limit),util.httpRequest(s,{q:e.q}).then(function(t){if(0===a.state.offset)switch(e.types){case"community":case"catalogthread":case"activity":case"digitalcontent":case"news":case"restaurant":o=t.results;break;case"column":o.zhuanlanList=t.results,o.joinNumStatue="show";break;case"product":o.shopData=t.results}else switch(e.types){case"community":case"digitalcontent":case"catalogthread":case"activity":case"news":case"restaurant":o=o.concat(t.results);break;case"column":o.zhuanlanList=o.zhuanlanList.concat(t.results);break;case"product":o.shopData=o.shopData.concat(t.results)}var n=!0;0===t.next&&(n=!1),"product"===e.types?a.store({mall:o,requestStatus:!0,hasNext:n}):"column"===e.types?a.store({info:o,requestStatus:!0,hasNext:n}):"digitalcontent"===e.types?a.store({danpinList:o,requestStatus:!0,hasNext:n}):a.store({list:o,requestStatus:!0,hasNext:n}),a.state.nextCount=t.next,wx.hideLoading()})}function getHaibaoFuncV2(t,e){wx.showLoading({title:"图片下载中..."}),util.httpRequest(e.url,{},"GET","v2").then(function(e){t.setData({shareAlter:"hide",haibaoImg:e.url,shareAlter1:"show"}),wx.hideLoading(),wx.downloadFile({url:e.url,success:function(t){wx.hideLoading(),200===t.statusCode?(wx.showToast({title:"下载成功"}),wx.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:function(t){console.log(t)}})):(wx.hideLoading(),wx.showToast({title:"下载失败"}))}})})}function getHaibaoFunc(t,e){wx.showLoading({title:"图片下载中..."});var a="/"+e.name+"/"+e.id+"/qrcode/1/";e.hasOwnProperty("url")&&(a=e.url),util.httpRequest(a).then(function(e){t.setData({shareAlter:"hide",haibaoImg:e.original_url,shareAlter1:"show"}),wx.hideLoading(),wx.downloadFile({url:e.original_url,success:function(t){wx.hideLoading(),200===t.statusCode?(wx.showToast({title:"下载成功"}),wx.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:function(t){console.log(t)}})):(wx.hideLoading(),wx.showToast({title:"下载失败"}))}})})}function detailShare(t,e){var a=e.currentTarget.dataset,o=a.url,n=a.types;switch(console.log(n),n){case"showShareAlter":t.setData({shareAlter:"show"});break;case"closeShareAlter":t.setData({shareAlter:"hide"});break;case"closehaibao":t.setData({shareAlter1:"hide"});break;case"haibaoBigImg":common.seeBigImg(1,o,"");break;case"getHaibao":"v2"===e.type?getHaibaoFuncV2(t,e):getHaibaoFunc(t,e);break;case"topIndex":wx.switchTab({url:"/pages/index/page0/page0"})}}function updateHttpRequest(t,e,a){util.httpRequest("/user/me/",e,"POST").then(function(e){if(a&&1===Number(a)){var o=t.data.tankuang;o[0]="hide",t.store({tankuang:o})}wx.hideLoading(),"success"===e.result?(a&&1===Number(a)&&common.showClickModal("修改成功"),common.setStorage("userInfo",e.user),t.store({myInfo:e.user}),showGetUserInfo(t)):a&&1===Number(a)&&common.showClickModal("修改失败")})}function nickNameUpdate(t,e){if(common.isNull(e))common.showTimeToast("请输入昵称");else{wx.showLoading({title:"修改中...",mask:!0});updateHttpRequest(t,{displayname:e},1)}}function photoUpdate(t,e){common.uploadImg(e,1,function(a,o){var n={};if("avatar"===e)n.avatar_url={oss_object:JSON.parse(a[0].data).url};else{var s=[];n.wx_paycode={oss_object:JSON.parse(a[0].data).url},o.forEach(function(t){s.push(t)}),t.setData({imgList:s})}updateHttpRequest(t,n,1)})}function userInfoBind(t,e){var a=e.detail;if(a.hasOwnProperty("userInfo")){wx.showLoading({title:"绑定中...",mask:!0});updateHttpRequest(t,{displayname:a.userInfo.nickName,avatar_url:{original_url:a.userInfo.avatarUrl}},2)}}function formList(t,e){common.commonFun(t);var a="/form/Record/?offset="+e+"&limit="+t.state.limit;util.httpRequest(a).then(function(a){wx.stopPullDownRefresh();var o=common.dataListHandle(t,a,t.data.list,e);t.setData({list:o.list,requestStatus:!0})})}function storeList(t,e){var a="/api/BranchToClient/getBranch?offset="+e+"&limit="+t.state.limit;util.httpRequest(a,{},"GET","v2").then(function(a){if("success"===a.result){var o=common.dataListHandle(t,a,t.data.list,e);t.setData({list:o.list,requestStatus:!0,hasNext:o.hasNext})}})}var util=require("util.js"),common=require("common.js");module.exports={showAbuotInfo:showAbuotInfo,aboutChangeEvent:aboutChangeEvent,showGetUserInfo:showGetUserInfo,newsChangeEvent:newsChangeEvent,newsNavList:newsNavList,newMovementList:newMovementList,getNewsDetail:getNewsDetail,navOnTapTag:onTapTag,activityType:activityType,actList:actList,dianzan:dianzan,dianzanList:dianzanList,pinglunList:pinglunList,pinglun:pinglun,huifuPinglun:huifuPinglun,subReply:subReply,BingUserInfo:BingUserInfo,getBanner:getBanner,searchSettle:searchSettle,searchVote:searchVote,searchActivity:searchActivity,detailShare:detailShare,getShequnData:getShequnData,getShequnConfig:getShequnConfig,shequnDetail:shequnDetail,nickNameUpdate:nickNameUpdate,photoUpdate:photoUpdate,userInfoBind:userInfoBind,albumConfig:albumConfig,albumList:albumList,albumChangeEvent:albumChangeEvent,formList:formList,getgg:getgg,storeList:storeList,myEventChange:myEventChange,getSignInData:getSignInData};