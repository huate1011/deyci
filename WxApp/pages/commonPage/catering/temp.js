"use strict";function recommend(t){util.httpRequest("/api/restaurant/Recommend",{},"GET","v2").then(function(e){t.setData({cateringList:e.results})})}function storeList(t,e){var a="/api/restaurant/showLists?offset="+e+"&limit="+t.state.limit+"&status="+t.state.status+"&lat="+t.state.lat+"&lng="+t.state.lng;t.state.key&&(a+="&key="+t.state.key),util.httpRequest(a,"","GET","v2").then(function(a){var s=common.dataListHandle(t,a,t.data.list,e);s.list.forEach(function(t){t.bili=Number(t.overall_rating)/5,t.bili=(100*Number(t.bili)).toFixed(2),t.bili=Number(t.bili)+"%",t.manjian=!1,t.manjian_desc="",t.reduction.hasOwnProperty("id")&&(t.manjian=!0,t.reduction.reductionExp.forEach(function(e){1===Number(e.preferential_way)&&(t.manjian_desc+="满"+e.threshold+"减"+e.preferential_value+";"),2===Number(e.preferential_way)&&(t.manjian_desc+="满"+e.threshold+"打"+e.preferential_value+"折;")}),t.manjian_desc=t.manjian_desc.substr(0,t.manjian_desc.length-1))}),t.store({requestStatus:!0,list:s.list,hasNext:s.hasNext,isHasKey:!0}),wx.hideLoading()})}function saomaPaidui(){wx.scanCode({onlyFromCamera:!0,success:function(t){console.log(t);var e=t.path.split("?");console.log(e[1]);var a=e[1].split("=");console.log(a[1]);var s=a[1].split("#");console.log(s[0]),wx.navigateTo({url:"/pages/catering/pages/queueIndex/queueIndex?id="+s[0]})}})}function saomaDiancan(){wx.scanCode({onlyFromCamera:!0,success:function(t){console.log(t);var e=t.path.split("?");console.log(e[1]);var a=e[1].split("=");console.log(a[1]);var s=[];if(a[1].indexOf("#")>-1)s=a[1].split("#");else{s=decodeURIComponent(a[1]).split("#")}console.log(s[0]),wx.navigateTo({url:"/pages/catering/pages/list/list?id="+s[0]+"&wayIndex="+s[1]})}})}function cateringNav(t){var e=t.currentTarget.dataset.index;if(Number(this.data.current)!==Number(e)||2===Number(e)){if(2===Number(e))return void this.store({bussAlter:["show"]});this.store({current:e,requestStatus:!1,list:[],bussAlter:["hide"]}),0===Number(e)&&(this.state.status=0),1===Number(e)&&(this.state.status=2),wx.showLoading({title:"",mask:!0}),this.state.offset=0,storeList(this,0)}}function screen(t){var e=t.currentTarget.dataset.index;Number(this.data.shaiXuan)!==Number(e)&&(this.store({current:2,shaiXuan:e,requestStatus:!1,bussAlter:["hide"]}),wx.showLoading({title:"",mask:!0}),this.state.status=e,this.state.offset=0,storeList(this,0))}function bindRegionChange(){var t=this;common.currentLocation(1,function(e){console.log(e),"chooseLocation:ok"===e.errMsg&&(common.setStorage("position",{lat:e.latitude,lng:e.longitude}),t.setData({addressDetail:e.address}),t.state.lat=e.latitude,t.state.lng=e.longitude,t.state.offset=0,storeList(t,0))})}function closeAlter(t){var e=t.currentTarget.dataset.index,a=this.data.bussAlter;a[e]="hide",this.store({bussAlter:a})}function openSearch(){wx.navigateTo({url:"/pages/catering/pages/search/search"})}function openList(t){var e=t.currentTarget.dataset.index,a=this.data.list;wx.navigateTo({url:"/pages/catering/pages/list/list?id="+a[e].id})}function remobdOpenList(t){var e=t.currentTarget.dataset.index,a=this.data.cateringList;wx.navigateTo({url:"/pages/catering/pages/list/list?id="+a[e].branch_id+"&classid="+a[e].class_id})}function comData(t){common.commonFun(t),t.state.key="",t.state.lat="",t.state.lng="",t.state.status=0,t.setData({cateringList:[],addressDetail:"定位中...",requestStatus:!1,current:0,addressInfo:"",shaiXuan:0,peise:getApp().globalData.peise}),t.cateringNav=cateringNav,t.closeAlter=closeAlter,t.screen=screen,t.openList=openList,t.remobdOpenList=remobdOpenList}function setCateringData(t){comData(t),t.saomaPaidui=saomaPaidui,t.saomaDiancan=saomaDiancan,t.bindRegionChange=bindRegionChange,t.openSearch=openSearch,recommend(t),common.currentLocation(3,function(e){e?(t.setData({addressDetail:e.result.address}),t.state.lat=e.result.ad_info.location.lat,t.state.lng=e.result.ad_info.location.lng,storeList(t,0)):t.setData({addressDetail:"定位失败"})})}var util=getApp().globalData.utilFun,common=getApp().globalData.commonFun,dataTemp=getApp().globalData.dataTempFun;module.exports={setCateringData:setCateringData,storeList:storeList,comData:comData};