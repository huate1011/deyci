"use strict";var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun,temp=require("temp.js");Page({data:{interfaceName:"form_order",requestStatus:!1,logoPosBottom:!0,payAndBingPhoneStatus:!1,list:[],nbPhone:!0,phone:"",btnPhoneNumber:!1},state:{pageOnShow:!1,isOnReachBottom:!0,isonPullDownRefresh:!1,hasmore:!0,offset:0,limit:10},onLoad:function(t){var e=this;wx.showLoading({title:"加载中...",mask:!0}),common.payAndBingPhoneSetData(e,function(t){e.setData({payAndBingPhoneStatus:!0})}),common.getAccessToken()?(common.commonFun(e),common.getWallet(e)):getApp().globalData.tokenUpdated=function(){console.log("update success"),common.commonFun(e),common.getWallet(e)},temp.loadFun(this),this.getOrderList(0)},onShow:function(){var t=this;getApp().globalData.formUpdateCallback=function(e){var s=t.data.list;t.getDetailInfo(s[e].id,e)},getApp().globalData.formDeleteCallback=function(e){var s=t.data.list;s.splice(e,1),t.store({list:s})}},onPullDownRefresh:function(){this.state.isonPullDownRefresh=!0,wx.showLoading({title:"加载中...",mask:!0}),this.state.offset=0,this.getOrderList(0)},onReachBottom:function(){this.state.isonPullDownRefresh||this.state.isOnReachBottom&&this.state.hasmore&&(wx.showLoading({title:"加载中...",mask:!0}),this.state.offset=this.state.offset+this.state.limit,this.getOrderList(this.state.offset),this.state.isOnReachBottom=!1)},store:function(t){this.setData(t)},getOrderList:function(t){var e=this,s="/form/order/?offset="+t+"&limit="+e.state.limit;util.httpRequest(s).then(function(s){var o=common.dataListHandle(e,s,e.data.list,t);e.store({requestStatus:!0,list:o.list})})},changeStatusEven:function(t){var e=this,s=e.data.list,o=t.currentTarget.dataset,a=o.index;e.state.backIndex=a,e.state.shopOrderId=s[a].shopOrderId,"del"===o.types?temp.delOrder(s[a].id,function(t){"success"===t&&(s.splice(a,1),e.store({list:s}))}):"pay"===o.types&&e.store({showPayMethod:!0,total_money:s[a].orderPrice,payId:0,payMethod:["success","circle"]})},getDetailInfo:function(t,e){var s=this,o=this.data.list,a="/form/order/"+t;util.httpRequest(a).then(function(t){"success"===t.result&&(o[e].orderStatusId=t.detail.orderStatusId,o[e].shopOrderId=t.detail.shopOrderId,s.store({list:o}))})}});