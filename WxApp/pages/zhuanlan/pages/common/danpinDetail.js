"use strict";function buildPage(){return{data:{payAndBingPhoneStatus:!1,requestStatus:!1,banner:[],adStatus:!0,currentTab:0,openType:"navigateTo",playStatus:"https://www.haojian.cn/wximg/zhuanlan/stop.png",playAction:"audioPlay",starttime:"00:00",priorOpacity:"opacity",nextOpacity:"opacity",contentVal:"",placeholderVal:"输入评论内容...",isFocus:!1,is_reply:!1,isPlayingMusic:!1,tgCenter:{fangShi:"hide"},convertible:!1,coupon:"",payId:0,useCode:!1,codeVal:"",isFixed:!1,btnShow:!1,nbPhone:!0,phone:"",bindPhone:!1,btnPhoneNumber:!1,hasColumn:!0,logoPosBottom:!1},tabOffsetTop:null,state:{danpinId:"",offset:0,limit:10,pageOnshow:!1,hasmore:!0,isOnReachBottom:!1,detailType:"",options:{}},store:function(t){this.setData(t)},onLoad:function(t){console.log(t);var e=decodeURIComponent(t.scene);console.log(e);var a={};if("undefined"!==e){var n=e.split("#");a={danpinId:n[0],uid:n[1]}}else a=t;console.log(a),this.config(),this.state.options=a,this.state.danpinId=a.danpinId,this.state.learnId=a.danpinId,wx.showLoading({title:"加载中...",mask:!0});var o=this;common.payAndBingPhoneSetData(o,function(t){o.setData({payAndBingPhoneStatus:!0})}),common.configData("learn",function(){dataTemp.getBanner(o,"learn_detail"),common.getAccessToken()?(o.getDetail(a.danpinId,!1,!0),common.commonFun(o),common.getWallet(o)):getApp().globalData.tokenUpdated=function(){console.log("update success"),o.getDetail(a.danpinId,!1,!0),common.commonFun(o),common.getWallet(o)}})},config:function(){},getDetail:function(t,e,a){common.shareLog(this,14,t);var n=this,o="";wx.getBackgroundAudioManager&&(o=wx.getBackgroundAudioManager());var i="/digitalcontent/detail/"+t+"/";util.httpRequest(i).then(function(t){if("success"===t.result){var i=t.results;n.state.productId=i.sales_product_id,"article"!==i.kind&&(i.duration=util.changeTimeFormat(i.duration));var s=i.fee;if(i.isMemberLearn&&i.member.isMember&&(s=i.fee_member),n.store({interfaceName:n.state.detailType,detail:i,total_money:s,tgDataDetail:i.productDetail,btnShow:!0,requestStatus:!0,nbPhone:1===Number(i.config.nbPhone)}),a&&wx.pro.fromSync(function(t){if(i.info){var e=WxParse.wxParse("article","html",i.info,n,5);n.store(e)}}),n.state.pageOnshow=!0,!wx.getBackgroundAudioManager)return;"audio"===i.kind?i.has_bought||i.is_preview?(getApp().globalData.audioData.audioId=i.id,n.audioPlay(e)):(getApp().globalData.audioData.isStop=!0,o.stop()):!1!==o.paused&&0!==o.paused||(getApp().globalData.audioData.isStop=!0,o.stop()),extensionTemp.tuiguangInfo(n),common.updateTabOffsetTop(n)}else common.showClickModal(t.msg);wx.hideLoading()})},onShow:function(){if(this.state.pageOnshow){var t=wx.getBackgroundAudioManager();!1!==t.paused&&0!==t.paused||this.getDetail(this.state.danpinId,!1,!1)}},onUnload:function(){var t=this.state.options,e=this.data.detail;t.hasOwnProperty("indexOf")&&getApp().globalData.updateDanpinCallback(t.indexOf),t.hasOwnProperty("collectIndex")&&!e.isCollect&&getApp().globalData.updateCollectList&&getApp().globalData.updateCollectList(t.collectIndex)},collect:function(t){var e=this.data.detail;t.id=e.id,t.typeid=7,t.remark="danpin_collect",common.getFormId(t),t.typeName="danpin",t.types=e.isCollect?"cancel":"collect";var a=this;common.collect(t,function(t){e.isCollect=!e.isCollect,a.setData({detail:e})})},getLikeList:function(){var t="/product/"+this.data.detail.product_id+"/like/?offset=0&limit=10";dataTemp.dianzanList(this,t)},dianzan:function(t){var e=this,a=this.data.detail;t.id=a.id,t.typeid=7,t.remark="danpin_zan",common.getFormId(t),common.wxAuthorize(e,function(a){a&&e.danpinDianzan(t)})},danpinDianzan:function(t){var e=t.currentTarget.dataset.method,a="/product/"+this.data.detail.product_id+"/like/";"DELETE"===e&&(a="/product/"+this.data.detail.product_id+"/like/delete/"),dataTemp.dianzan(this,a,e)},getComment:function(t){var e=this.data.detail.product_id,a="/product/"+e+"/comment/?offset="+t+"&limit="+this.state.limit;dataTemp.pinglunList(this,a,t)},submitPingLun:function(t){var e=this,a=this.data.detail;t.id=a.id,t.typeid=7,t.remark="danpin_comment",common.getFormId(t);var n=this;common.wxAuthorize(n,function(o){if(o){var i="/product/"+a.product_id+"/comment/";t.p_type="digitalcontent",t.did=n.state.danpinId,dataTemp.pinglun(n,i,t),e.store({currentTab:1})}})},huifu:function(t){var e=t.currentTarget.dataset.commentid,a="/comment/"+e+"/delete/?product=product";dataTemp.huifuPinglun(this,a,t)},submitReply:function(t){var e="/comment/"+this.state.commentId+"/reply/?product=product";dataTemp.subReply(this,e,t)},inputBlur:function(){this.store({isFocus:!1,is_reply:!1,contentVal:"",placeholderVal:"输入评论内容..."})},inputVal:function(t){this.store({contentVal:t.detail.value})},buyZhuanlan:function(t){if(t.id=this.data.detail.id,t.typeid=7,t.remark="danpin_subscribe",common.getFormId(t),this.data.detail.fee>0&&!this.data.iphoneShow)return void common.showClickModal("当前小程序暂不支持该功能");var e=this,a=this.data.detail,n=this.data.tankuang;if(!e.data.bindPhone&&e.data.nbPhone)return void wx.showModal({title:"提示",content:"您还未绑定手机号，请先绑定",showCancel:!0,success:function(t){t.confirm&&(n[3]="show",e.store({tankuang:n}))}});t.currentTarget.dataset.types||(t.currentTarget.dataset.types=t.types,t.detail.value=""),"bundled"===a.fee_type?wx.showModal({title:"提示",content:"该单品绑定了专栏，您是否想要订阅整个专栏？",showCancel:!0,success:function(n){n.confirm&&(0===a.fee?payTempImport.payChangeEvent(e,t):(wx.showLoading({title:"",mask:!0}),extensionTemp.getProductDetial(e,a.fee_product_id,"bundled")))}}):"free"===a.fee_type?payTempImport.payChangeEvent(this,t):("show"===n[3]&&(n[3]="hide",this.data.CountdownVal[2]="发送验证码",this.data.CountdownTime[2]=60,this.data.onClick[2]=!0),this.store({tankuang:n,CountdownVal:this.data.CountdownVal,CountdownTime:this.data.CountdownTime,onClick:this.data.onClick,showPayMethod:!0}))},onReachBottom:function(){0!==parseInt(this.data.currentTab)&&this.state.isOnReachBottom&&this.state.hasmore&&(wx.showLoading({title:"加载中...",mask:!0}),this.state.offset=this.state.offset+this.state.limit,this.getComment(this.state.offset),this.state.isOnReachBottom=!1)},swichNav:function(t){var e=parseInt(t.currentTarget.dataset.current);this.data.currentTab!==e&&(1===Number(e)&&(this.getComment(0),this.getLikeList()),this.store({currentTab:t.currentTarget.dataset.current}))},gotolistPage:function(t){var e=t.currentTarget.dataset.index,a=this.data.commentInfo[e];common.setStorage("commentInfo",a),wx.navigateTo({url:"/pages/comment/commentList/commentList?productType=product"})},onPageScroll:function(t){common.goTopEvent(this,t.scrollTop),common.scrollIsTabFixed(this,t)},onBackTop:function(){common.isscrollToPage(this)},onShareAppMessage:function(t){var e=this.state.danpinId,a=this.data.detail,n="";switch(a.kind){case"audio":n="/pages/zhuanlan/pages/danpinAudeoDetail/danpinAudeoDetail?formType=1&danpinId="+e;break;case"video":n="/pages/zhuanlan/pages/danpinVideoDetail/danpinVideoDetail?formType=1&danpinId="+e;break;case"article":n="/pages/zhuanlan/pages/danpinTuwenDetail/danpinTuwenDetail?formType=1&danpinId="+e}return extensionTemp.tkHide(this),n=n+"&uid="+this.data.myInfo.id,{title:a.subject,path:n}},columnShare:function(){dpTemp.columnShare(this,this.data.detail.column.product_id)},bindPhoneNumber:function(t){t.pageName="zhuanlan",getPhone.phoneChange(this,t)},payEvent:function(t){payTempImport.payChangeEvent(this,t)},callPayment:function(t,e,a,n){wx.showLoading({title:"",mask:!0});var o="/column/"+t.data.detail.id+"/payment/",i={wx_form_id:a,types:"danpin",product_id:t.data.detail.fee_product_id,platform:e};payTempImport.payment(t,o,i,function(e,a){t.resultEvent(t,e,a)})},walletPay:function(t){payTempImport.payRequest(t,function(e){t.resultEvent(t,e.result,e.msg)})},resultEvent:function(t,e,a){if(wx.hideLoading(),"free"===t.data.detail.fee_type)return void t.getDetail(t.state.danpinId,!0,!1);"success"===e?wx.showModal({title:"提示",content:"操作成功",showCancel:!1,success:function(e){common.getAlter(t,"paypop",function(e,a){"show"===a?t.setData({alter:e,alterHidden:a}):t.getDetail(t.state.danpinId,!0,!1)})}}):common.showClickModal(a)},shopListEvent:function(t){var e=t.currentTarget.dataset;e.name="payAlter",common.openUrl(e,this),this.getDetail(this.state.danpinId,!0,!1)},onUseCode:function(){dpTemp.onUseCode(this)},changeVal:function(t){dpTemp.changeVal(t,this)},audioPlay:function(){},audioPause:function(){},sliderchange:function(){},funended:function(){}}}var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun,dataTemp=getApp().globalData.dataTempFun,getPhone=getApp().globalData.phoneFun,WxParse=require("../../../../wxParse/wxParse.js"),extensionTemp=require("../../../commonPage/extension/comfunc.js"),dpTemp=require("../../../commonPage/zhuanlan/temp.js"),payTempImport=getApp().globalData.payTemp;module.exports={buildPage:buildPage};