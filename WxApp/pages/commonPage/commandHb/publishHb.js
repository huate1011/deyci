"use strict";function getDetails(t){var o=t.data.list,e=getApp().globalData.hbcDetailIndex,a="/hongbaopool/"+o[e].id+"/";util.httpRequest(a).then(function(a){1!==Number(t.data.current)&&o[e].status!==a.status?o.splice(e,1):(o[e].sent_count=a.sent_count,o[e].total_count=a.total_count,o[e].status=a.status,o[e].sheng=Number(a.total_count)-Number(a.sent_count)),t.store({list:o}),getApp().globalData.hbcDetailIndex=-1})}function navCon(t){wx.setNavigationBarColor&&wx.setNavigationBarColor({frontColor:"#ffffff",backgroundColor:"#ff4b4b"}),wx.hideLoading(),common.commonFun(t)}function updataData(t){common.getAccessToken()?navCon(t):getApp().globalData.tokenUpdated=function(){console.log("update success"),navCon(t)}}function areaData(t,o){wx.setNavigationBarColor&&wx.setNavigationBarColor({frontColor:"#ffffff",backgroundColor:"#ff4b4b"});var e="",a=t.data.current,n="/hongbaopool/?offset="+o+"&limit="+t.state.limit+"&acid="+getApp().globalData.acid;2===Number(a)&&(e="normal",n+="&status="+e),3===Number(a)&&(e="finish",n+="&status="+e),util.httpRequest(n).then(function(e){var a=common.dataListHandle(t,e,t.data.list,o);t.setData({list:a.list,requestStatus:!0,logoPosBottom:!0})})}function areaEvent(t,o){var e=o.currentTarget.dataset;if("nav"===e.types){if(Number(t.data.current)===Number(e.current))return;wx.showLoading({title:"加载中...",mask:!0}),t.setData({list:[],requestStatus:!1,current:e.current}),t.state.offset=0,areaData(t,0)}else"lingqu"===e.types&&(getApp().globalData.hbcDetailIndex=e.index,wx.navigateTo({url:"/pages/commandHb/pages/receiveHb/receiveHb?id="+e.id}))}function hbEvent(t){klhbEvent(this,t)}function enterInput(t){var o=this.data.kouling,e=t.detail.value,a=/^[\u4E00-\u9FA5]{1,20}$/,n=a.test(e);common.isNull(e)?o="":n&&(o=e),this.store({kouling:o})}function hbAreaEcent(t){areaEvent(this,t)}function navColor(t,o){t.hbEvent=hbEvent,t.enterInput=enterInput,t.hbAreaEcent=hbAreaEcent,common.configData("hongbao",function(){common.commonFun(t),"klhb"===o?updataData(t):areaData(t,0)})}function hongBaoTishi(t,o){wx.hideLoading(),wx.showModal({title:"提示",content:o,showCancel:!1,success:function(o){t.state.options&&t.state.options.hasOwnProperty("id")?wx.redirectTo({url:"/pages/commandHb/pages/publishSuccess/publishSuccess?id="+t.state.hongbaopoolId}):wx.navigateTo({url:"/pages/commandHb/pages/publishSuccess/publishSuccess?id="+t.state.hongbaopoolId}),t.setData({kouling:"",money:"",geshu:"",isShareHb:0,switchStatus:!1,hbq:"hide",hbSet:!1,content:"",upImg:"",payPrice:0}),common.commonFun(t)}})}function submitFun(t,o){var e=this,a=o.detail.value.money,n=o.detail.value.number,s=o.detail.value.kouling,i=o.detail.value.ggContent;if(common.isNull(s))return void common.showTimeToast("请输入口令");if(common.isNull(a))return void common.showTimeToast("请输入赏金");if(a>0&&!t.data.iphoneShow)return void common.showClickModal("当前小程序暂不支持该功能");if(common.isNull(n))return void common.showTimeToast("请输入数量");if(!/^[0-9]+$/.test(n)||0===Number(n))return void common.showClickModal("请输入正确的数量");wx.showLoading({title:"请求中...",mask:!0});var r=!1,u=common.getStorage("config").hongbao.isFixed;0===Number(u)||0===Number(t.data.ishbSet)?r=!0:1===Number(u)&&1===Number(t.data.ishbSet)&&(r=!1);var l=!1;1===Number(t.data.isShareHb)&&(l=!0);var m={wx_form_id:o.detail.formId,take_method:"pass",total_hongbao:Number(a),total_count:Number(n),is_random:r,is_public:l,pass:{pass:s,text:i,attachments:t.state.upImg}},c=t.state.options;c&&c.hasOwnProperty("id")&&(m.related_obj_id=Number(c.id),m.related_obj_type=c.name),util.httpRequest("/hongbaopool/",m,"POST").then(function(a){if(wx.hideLoading(),"success"===a.result)if(t.state.orderId=a.hongbaopool.shop_order_id,t.state.hongbaopoolId=a.hongbaopool.id,"normal"===a.hongbaopool.status)hongBaoTishi(t,"支付成功");else{var n="/order/"+a.hongbaopool.shop_order_id+"/payment/",s={wx_form_id:o.detail.formId,method:"pay",platform:"weixin"};payTempImport.payment(e,n,s,function(o,e){"success"===o?hongBaoTishi(t,"支付成功"):common.showClickModal(e)})}else common.showClickModal(a.msg)})}function klhbEvent(t,o){var e=o.currentTarget.dataset;if("shareHb"===e.types)0===Number(e.index)?e.index=1:e.index=0,t.store({isShareHb:e.index});else if("hbSet"===e.types)0===Number(e.index)?e.index=1:e.index=0,t.store({ishbSet:e.index});else if("submit"===e.types)submitFun(t,o);else if("money"===e.types){var a=Number(o.detail.value);t.setData({payPrice:a,total_money:a})}else"uploadgg"===e.types&&common.uploadImg("hongbao",1,function(o,e){var a=[{oss_object:JSON.parse(o[0].data).url}];t.state.upImg=a,t.setData({ggImg:e})})}var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun,payTempImport=getApp().globalData.payTemp;module.exports={navColor:navColor,navCon:navCon,klhbEvent:klhbEvent,hongBaoTishi:hongBaoTishi,areaEvent:areaEvent,areaData:areaData,getDetails:getDetails};