"use strict";function scrollIsTabFixed(e,t){if(null!==e.tabOffsetTop){var n=e.data.isTabFixed,o=t.scrollTop>=e.tabOffsetTop;n!=o&&e.setData({isTabFixed:o,salexNav:"nav_"+e.state.index})}}function updateTabOffsetTop(e){wx.createSelectorQuery&&setTimeout(function(){var t=wx.createSelectorQuery();t.select("#tab").boundingClientRect(),t.selectViewport().scrollOffset(),t.exec(function(t){t[0]&&t[1]&&(t[1].scrollTop>0?t[0].top>0?e.tabOffsetTop=t[1].scrollTop+t[0].top:e.tabOffsetTop=t[1].scrollTop-Math.abs(t[0].bottom)+2*t[0].height:e.tabOffsetTop=t[0].top)})},1500)}function getExtConfig(){wx.getExtConfigSync&&wx.getExtConfigSync();return extData.getData().ext&&extData.getData().ext.acid?extData.getData().ext:wx.getExtConfigSync()}function IsInArray(e,t){return-1!==(","+e.join(",")+",").indexOf(","+t+",")}function setInfo(e,t){try{wx.setStorageSync(e,t)}catch(e){console.log(e)}}function timeCountDown(e,t,n){var o=0;if("ptd"===n)Number(t)>0&&(o=1e3*Number(t));else{t=util.formatTimeStamp(t);o=t-Date.parse(new Date)}if(Number(o)<=0)return clearInterval(e.data.time),{day:"0",hour:"00",minute:"00",second:"00"};var a=parseInt(o/1e3),s=Math.floor(a/86400),r=Math.floor((a-24*s*60*60)/3600),i=Math.floor((a-24*s*60*60-3600*r)/60),c=Math.floor(a-24*s*60*60-3600*r-60*i);return r<10&&(r="0"+r),i<10&&(i="0"+i),c<10&&(c="0"+c),{day:s,hour:r,minute:i,second:c}}function payAndBingPhoneSetData(e,t){e.setData({CountdownVal:["发送验证码","发送验证码","发送验证码","发送验证码"],tankuang:["hide","hide","hide","hide"],CountdownTime:[60,60,60,60],onClick:[!0,!0,!0,!0],clearTimeout:!0,scenario:["change_password","change_pay_password"],total_money:0,cash_balance:0,paymentId:"",showPayMethod:!1,payMethod:["success","circle"],payTk:"hide",Board:"show",passwords:"",showPassword:["","","","","",""],passwordLength:0,isSetPayPassword:"",alterHidden:"hide"}),t()}function getInfo(e){try{var t=wx.getStorageSync(e);return t||{}}catch(e){console.log(e)}return null}function showClickModal(e){wx.hideLoading(),wx.showModal({title:"提示",content:e,icon:"loading",showCancel:!1,success:function(e){}})}function showTimeToast(e){wx.showToast({title:e,duration:2e3,icon:"none",mask:!0})}function jsTrim(e){for(var t=0;" "==e.charAt(t)&&t<e.length;t+=1);if(t==e.length)return"";for(var n=e.substr(t),t=n.length-1;" "==n.charAt(t)&&t>=0;t-=1);return n=n.substr(0,t+1)}function isNull(e){var t=new RegExp("^[ ]+$");if(!e||null==e||""===e||0===e.length||t.test(e))return!0;if(!/^[0-9]+.?[0-9]*$/.test(e)&&""==jsTrim(e.replace(/\n/g,"")))return!0;return!1}function nullObject(e){for(var t in e)return!1;return!0}function compareVersion(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var o=0;o<n;o++){var a=parseInt(e[o]),s=parseInt(t[o]);if(a>s)return 1;if(a<s)return-1}return 0}function getSysInfo(e){wx.getSystemInfo({success:function(t){var n=t.SDKVersion,o=compareVersion(n,"1.2.0");void 0!==n&&1===Number(o)?e.setData({btnPhoneNumber:!0}):e.setData({btnPhoneNumber:!1})}})}function singleUpload(e,t){var n=new Date,o=e.key_prefix+n.getFullYear()+n.getMonth()+n.getDate()+n.getHours()+n.getMinutes()+n.getSeconds()+Math.floor(1e5*Math.random())+"_jpg";return wx.pro.uploadFile({url:e.image_upload_url,filePath:t,name:"file",formData:{token:e.token,key:o}})}function uploadImg(e,t,n){var o="";wx.pro.chooseImage({count:t,sizeType:["compressed"],sourceType:["album","camera"]}).then(function(t){o=t.tempFilePaths;var n="/album/0/photo_upload_url/?scenario="+e;return util.httpRequest(n)}).then(function(e){wx.showLoading({title:"上传中，请稍等..."});var t=[];return o.forEach(function(n){t.push(singleUpload(e,n))}),wx.pro.all(t)}).then(function(e){wx.hideLoading(),n(e,o)})}function getPersonInfo(){return util.httpRequest("/user/me/").then(function(e){return setInfo("userInfo",e),e})}function uploadAudio(e,t,n,o){var a="/album/0/audio_upload_url/?scenario=hongbao&audioSize="+n,s=0;util.httpRequest(a).then(function(n){s=n.process_delay;var o=new Date,a=n.key_prefix+o.getFullYear()+o.getMonth()+o.getDate()+o.getHours()+o.getMinutes()+o.getSeconds()+Math.floor(1e5*Math.random())+"_hb_"+e;return wx.pro.uploadFile({url:n.image_upload_url,filePath:t,name:"file",formData:{token:n.token,key:a}})}).then(function(e){o(e,s)})}function prompt(e,t){wx.hideLoading(),t||(t="获取数据失败"),404!==e&&403!==e||wx.showModal({title:"提示",content:t,showCancel:!1,success:function(e){wx.navigateBack({})}})}function wxOpenSet(e,t){wx.getSetting||(wx.hideLoading(),wx.showModal({title:"提示",content:"当前微信版本过低，请升级至高版本",showCancel:!1}),t("")),wx.getSetting({success:function(n){n.authSetting[e]||(wx.hideLoading(),wx.showModal({title:"用户未授权",content:"如需正常使用该功能，请点击“确定”并在授权管理中选中“通讯地址”，然后打开开关，即可使用",showCancel:!1,success:function(e){e.confirm&&wx.openSetting({success:function(e){wx.getLocation({type:"wgs84",success:function(e){t(e)}})}})}}))}})}function conversionAddress(e,t,n){new QQMapWX({key:"PE4BZ-OTSPG-SXBQG-IPW4I-X3N4O-SGF5X"}).reverseGeocoder({location:{latitude:e,longitude:t},success:function(e){n(e)}})}function currentLocation(e,t){0===Number(e)&&wx.getLocation({type:"wgs84",success:function(e){t(e)},fail:function(){wxOpenSet("scope.userLocation",function(e){t(e)})}}),1===Number(e)&&wx.chooseLocation({success:function(e){t(e)},fail:function(){wxOpenSet("scope.userLocation",function(e){conversionAddress(e.latitude,e.longitude,function(e){t(e)})})}}),2===Number(e)&&wx.chooseAddress({success:function(e){t(e)},fail:function(){wxOpenSet("scope.address",function(e){conversionAddress(e.latitude,e.longitude,function(e){t(e)})})}}),3===Number(e)&&wx.getLocation({type:"wgs84",success:function(e){conversionAddress(e.latitude,e.longitude,function(e){t(e)})},fail:function(){wxOpenSet("scope.userLocation",function(e){conversionAddress(e.latitude,e.longitude,function(e){t(e)})})}})}function scopeRecord(){if(!wx.getSetting)return wx.hideLoading(),void wx.showModal({title:"提示",content:"当前微信版本过低，请升级至高版本",showCancel:!1});wx.getSetting({success:function(e){e.authSetting["scope.record"]||wx.authorize({scope:"scope.record",success:function(){},fail:function(e){wx.showModal({title:"用户未授权",content:"如需正常使用该功能，请点击“确定”并在授权管理中选中“录音功能”，然后打开开关，即可使用",showCancel:!1,success:function(e){e.confirm&&wx.openSetting({success:function(e){}})}})}})}})}function removeAccessToken(){try{wx.removeStorageSync("token"),wx.removeStorageSync("expire_at")}catch(e){console.log(e)}}function getAccessToken(){var e=getInfo("token");if(!e)return null;var t=getInfo("expire_at");if(t){if(Date.parse(new Date)<t)return e}return removeAccessToken(),null}function setToken(e){setInfo("token",e.access_token),setInfo("refresh_token",e.refresh_token);var t=1e3*e.expires_in/2;setInfo("expire_at",Date.parse(new Date)+t)}function getToken(){var e=getExtConfig();return wx.pro.login({}).then(function(t){var n=t.code,o={grant_type:"authorization_code",code:"wx "+e.acid+" "+n,client_id:"string",client_secret:"string"};return util.httpRequest("/oauth/token/",o,"POST")}).then(function(e){return"success"===e.result?setToken(e.token):console.log(e.msg),e})}function refreshToken(){var e={grant_type:"refresh_token",refresh_token:getInfo("refresh_token"),client_id:"string",client_secret:"string"};return util.httpRequest("/oauth/token/",e,"POST").then(function(e){return"success"===e.result?(setToken(e.token),e):getToken()}).catch(function(e){return wx.removeStorageSync("refresh_token"),e})}function getCountDown(e,t){setInterval(function(){var n=Date.parse(new Date),o=e-n;if(e-n!=0){var a=parseInt(o/1e3),s=Math.floor(a/86400),r=Math.floor((a-24*s*60*60)/3600),i=Math.floor((a-24*s*60*60-3600*r)/60),c=Math.floor(a-24*s*60*60-3600*r-60*i);s<10&&(s="0"+s),i<10&&(i="0"+i),c<10&&(c="0"+c);t(r+"小时 "+i+"分钟 "+c+"秒")}},1e3)}function yanzhengma(e){var t="/ticket/?acid="+getExtConfig().acid;8===e.length?t+="&code="+e:t+="&phone="+e,util.httpRequest(t).then(function(t){wx.hideLoading(),"success"===t.result?8===e.length?wx.navigateTo({url:"/pages/activity/pages/yanpiao2/yanpiao2?yanzhengma="+e}):wx.navigateTo({url:"/pages/activity/pages/dcyList/dcyList?phone="+e}):showClickModal(t.msg)})}function seeBigImg(e,t,n,o){if(1===e)wx.previewImage({urls:[t]});else{var a=[];if("swipers"===o)a=n;else for(var s=0;s<n.length;s+=1)a[s]=n[s].original_url;wx.previewImage({current:t,urls:a})}}function see_oss_bject(e,t){for(var n=[],o=0;o<t.length;o+=1)n[o]=t[o].oss_bject;wx.previewImage({current:e,urls:n})}function openMap(e,t){wx.openLocation({latitude:Number(e),longitude:Number(t),scale:Number(28)})}function phoneCall(e){if(isNull(e))return void showClickModal("暂无联系电话！");wx.makePhoneCall({phoneNumber:e+""})}function wxAuthorize(e,t){getPersonInfo().then(function(e){e.avatar_url.original_url||e.displayname?t(!0):wx.showModal({title:"提示",content:"使用该功能需要上传用户信息",success:function(e){e.cancel||wx.navigateTo({url:"/pages/common/pages/my/my"})}})})}function goTopEvent(e,t){var n=!1;n=!!wx.pageScrollTo,t>300&&!e.data.showGoTop?e.setData({showGoTop:!0,isPageScrollTo:n}):t<300&&e.data.showGoTop&&e.setData({showGoTop:!1,isPageScrollTo:n})}function isscrollToPage(e){"shopList"===e.data.interfaceName&&"side"===e.data.shopTempName?e.setData({scrollTop:0}):wx.pageScrollTo?wx.pageScrollTo({scrollTop:0}):showClickModal("您当前微信版本过低")}function dataListHandle(e,t,n,o){wx.stopPullDownRefresh(),t.count>0?n=0===o?t.results:n.concat(t.results):0===o&&(n=[]);var a=!0;return t.hasOwnProperty("next")?(console.log("count:"+t.count+";next:"+t.next),0===t.next?(e.state.hasmore=!1,a=!1):(e.state.hasmore=!0,a=!0)):e.state.hasmore=!1,e.state.pageOnShow=!0,e.state.isOnReachBottom=!0,e.state.isonPullDownRefresh=!1,e.state.scrolltolower=!0,wx.hideLoading(),{list:n,hasNext:a,count:t.count}}function pageTiaoZhuan(e,t,n,o){var a=pageUrl.tiaoZhuan(e,t,n,o);if(console.log("url:"+a),a){var s=getCurrentPages().length;if(Number(s)>=5&&"page"===e[0]?wx.redirectTo({url:a}):"payAlter"===o?"wb"===e[0]||"navigateTo"===n.data.openType?wx.navigateTo({url:a}):wx.redirectTo({url:a}):wx.navigateTo({url:a}),"wb"===e[0]){var r=getInfo("indexpop");r.status=!0,setInfo("indexpop",r),n.setData({alterHidden:"hide"})}}}function openUrl(e,t){if("openWindow"===e.types){var n=e.url;if(n){var o=n.split("_");"tel"===o[0]?phoneCall(o[1]):"map"===o[0]?openMap(o[1],o[2]):"payAlter"===e.name?pageTiaoZhuan(o,n,t,"payAlter"):pageTiaoZhuan(o,n,t,"")}else"payAlter"===e.name&&seeBigImg(1,e.img)}else{var a=getInfo("paypop");a.status=!0,setInfo("paypop",a)}t.setData({alterHidden:"hide"})}function ewmOpenWin(e){console.log(JSON.stringify(e));var t=decodeURIComponent(e.scene);if(!t||"undefined"===t)return!1;if(!isNaN(t)){if(!e.query||void 0===e.query)return!1;if(!e.query.scene||void 0===e.query.scene)return!1;t=decodeURIComponent(e.query.scene)}var n=t.split("_");return!(n.length<1)&&("code"===n[0]?yanzhengma(n[1]):pageTiaoZhuan(n,t),!0)}function getWallet(e){util.httpRequest("/wallet/").then(function(t){var n=e.data.bindPhone;n=""!==t.phone&&null!==t.phone,e.setData({cash_balance:Number(t.cash_balance).toFixed(2),hongbao:t,balance:Number(t.balance).toFixed(2),bindPhone:n,bindWx:t.has_wx,showPhone:t.phone,isSetPayPassword:t.has_pay_password,mypoint:t.mypoint,member:t.memberDiscount,membName:t.name,grade:t.grade}),e.state.isSetPayPassword=t.has_pay_password,wx.hideLoading()})}function walletInfo(e,t){util.httpRequest("/wallet/").then(function(n){var o=e.data.bindPhone;o=""!==n.phone&&null!==n.phone,e.setData({cash_balance:Number(n.cash_balance).toFixed(2),hongbao:n,balance:Number(n.balance).toFixed(2),bindPhone:o,bindWx:n.has_wx,showPhone:n.phone,isSetPayPassword:n.has_pay_password,mypoint:n.mypoint,member:n.memberDiscount,membName:n.name,grade:n.grade}),e.state.isSetPayPassword=n.has_pay_password,t(n)})}function moduEvent(e){var t=e.ui.modules,n={activity:!1,shequn:!1,news:!1,zhuanlan:!1,mall:!1,album:!1,extension:!1,cashcard:!1,sameCity:!1,dianCan:!1,hongbao:!1,form:!1,easyYuyue:!1,appointment:!1,carpool:!1,business:!1,house:!1,bargain:!1,hotel:!1,bag:!1,answer:!1,signIn:!1};return t.forEach(function(e){switch(e){case"activity":n.activity=!0;break;case"community":n.shequn=!0;break;case"news":n.news=!0;break;case"learn":n.learn=!0;break;case"album":n.album=!0;break;case"shop":n.mall=!0;break;case"sales":n.extension=!0;break;case"prepaid":n.cashcard=!0;break;case"restaurant":n.dianCan=!0;break;case"catalog":n.sameCity=!0;break;case"hongbao":n.hongbao=!0;break;case"form":n.form=!0;break;case"reserve":n.easyYuyue=!0;break;case"appointment":n.appointment=!0;break;case"carpool":n.carpool=!0;break;case"business":n.business=!0;break;case"house":n.house=!0;break;case"bargain":n.bargain=!0;break;case"hotel":n.hotel=!0;break;case"bag":n.bag=!0;break;case"answer":n.answer=!0;break;case"signIn":n.signIn=!0}}),n}function advertEvent(e){var t={detail:""},n={userDefined:t,activity:t,shequn:t,news:t,zhuanlan:t,mall:t,sameCity:t,form:t,easyYuyue:t,appointment:t,car:t,settle:t,house:t,bargain:t,hotel:t,bag:t,vote:t};if(e.ui.hasOwnProperty("ads")){var o=e.ui.ads;n.userDefined=o[16]?o[16]:t,n.activity=o[1]?o[1]:t,n.shequn=o[2]?o[2]:t,n.news=o[3]?o[3]:t,n.zhuanlan=o[7]?o[7]:t,n.mall=o[8]?o[8]:t,n.sameCity=o[14]?o[14]:t,n.form=o[23]?o[23]:t,n.easyYuyue=o[27]?o[27]:t,n.appointment=o[30]?o[30]:t,n.car=o[29]?o[29]:t,n.settle=o[28]?o[28]:t,n.house=o[31]?o[31]:t,n.bargain=o[32]?o[32]:t,n.hotel=o[12]?o[12]:t,n.bag=o[33]?o[33]:t}return n}function getConfig(e){var t="/hdh/"+getExtConfig().acid+"/config/?key=ui",n=getInfo("config");util.httpRequest(t).then(function(t){try{getApp().globalData.phoneModal.phoneModalLimit=t.ui.phoneModalLimit,n.modules=moduEvent(t),n.advert=advertEvent(t),n.underlinePay=t.ui.underlinePay,n.popAuth=t.ui.popAuth,n.host=t.ui.host,n.copyright=!1,t.ui.hasOwnProperty("copyright")&&(n.copyright=t.ui.copyright),n.copyrightUrl="",t.ui.hasOwnProperty("copyrightUrl")&&(n.copyrightUrl=t.ui.copyrightUrl);var o={};t.ui.hasOwnProperty("contactInfo")?(o=t.ui.contactInfo,o.hasOwnProperty("contactDisplay")||(o.contactDisplay=0),o.hasOwnProperty("telDisplay")||(o.telDisplay=0)):o={contactDisplay:0,telDisplay:0},t.ui.hasOwnProperty("learn")&&(n.learn=t.ui.learn),n.contactInfo=o,setInfo("config",n),e(n)}catch(e){console.log(e)}})}function adError(e){console.log(e),e&&this.setData({adStatus:!1})}function openLinkEvent(e){var t=e.currentTarget.dataset;console.log(t),openUrl(t,this)}function store(e){this.setData(e)}function openApp(e){var t=e.currentTarget.dataset;wx.previewImage({urls:[t.url]})}function telEvent(e){phoneCall(e.currentTarget.dataset.url)}function commonFun(e){getSysInfo(e),getConfig(function(t){console.log("config update success");var n=getApp().globalData.phoneModal,o=!0;n.isIphone&&0===Number(n.phoneModalLimit)&&(o=!1),console.log(o);var a=getInfo("config"),s=e.data;a.logoPosBottom=s.logoPosBottom,a.adStatus=!!s.hasOwnProperty("adStatus")&&s.adStatus,a.contactStatus=!!s.hasOwnProperty("contactStatus")&&s.contactStatus,e.setData({config:a,peise:getExtConfig().colors,myInfo:getInfo("userInfo"),iphoneShow:o})}),e.adError=adError,e.telEvent=telEvent,e.openLinkEvent=openLinkEvent,e.openApp=openApp,e.store=store}function getAlter(e,t,n){var o="/hdh/"+getApp().globalData.acid+"/ads/?type="+t;util.httpRequest(o).then(function(e){var o="hide";if(e.results.length>0)if("indexpop"===t){var a=getInfo("indexpop");a?a.link!==e.results[0].link||a.status?a.link!==e.results[0].link&&(o="show"):a.hasOwnProperty("status")&&!a.status&&(o="show"):o="show","show"===o&&setInfo("indexpop",e.results[0])}else if("paypop"===t){var s=getInfo("paypop");s?s.link===e.results[0].link?s.hasOwnProperty("status")&&!s.status&&(o="show"):s.link!==e.results[0].link&&(o="show"):o="show","show"===o&&setInfo("paypop",e.results[0])}n(e.results,o)})}function configData(e,t){var n="/hdh/"+getExtConfig().acid+"/config/?key="+e,o=getInfo("config");return util.httpRequest(n).then(function(n){if("shequn"===e&&(o.shequn=n.shequn),"album"===e&&(o.album=n.album),"shop"===e&&(o.shop=n.shop),"learn"===e&&(o.learn=n.learn),"hongbao"===e){var a={};n.hasOwnProperty("hongbao")&&(a=n.hongbao,n.hongbao.hasOwnProperty("isFixed")||(n.hongbao.isFixed=0),n.hongbao.hasOwnProperty("isOpen")||(n.hongbao.isOpen=0)),o.hongbao=a}"activity"===e&&(o.activity=n.activity),"news"===e&&(o.news=n.news),"catalog"===e&&(o.catalog=n.catalog),"restaurant"===e&&(o.restaurant=n.restaurant),"integralShop"===e&&(o.integralShop=n.integralShop),setInfo("config",o),t(o)})}function hdhInfo(){var e="/hdh/"+getExtConfig().acid+"/";return util.httpRequest(e).then(function(e){return setInfo("hdhInfo",e),e})}function shareLog(e,t,n){var o=e.state.options;if(o.hasOwnProperty("uid")){var a={uid:o.uid,objType:t,objId:n,formType:2};o.hasOwnProperty("formType")&&(a.formType=1),console.log(a);util.httpRequest("/common/Common/shareLog",a,"POST","v2").then(function(e){console.log(e)})}}function getFormId(e){var t={wx_form_id:e.detail.formId,id:e.id,typeid:e.typeid,remark:e.remark};util.httpRequest("/formId/",t,"POST").then(function(e){})}function collect(e,t){var n={id:e.id,typeTxt:e.typeName,types:e.types};wx.showLoading({title:"请稍后..."}),util.httpRequest("/collect/",n,"POST").then(function(e){wx.hideLoading(),t(e)})}var util=require("util.js"),pageUrl=require("pageUrl.js"),QQMapWX=require("qqmap-wx-jssdk.js"),extData=require("data.js");module.exports={getPersonInfo:getPersonInfo,getWallet:getWallet,uploadImg:uploadImg,refreshToken:refreshToken,getCountDown:getCountDown,getExtConfig:getExtConfig,hdhInfo:hdhInfo,ewmOpenWin:ewmOpenWin,yanzhengma:yanzhengma,getToken:getToken,getConfig:getConfig,configData:configData,setStorage:setInfo,getStorage:getInfo,seeBigImg:seeBigImg,see_oss_bject:see_oss_bject,openMap:openMap,phoneCall:phoneCall,openUrl:openUrl,getAccessToken:getAccessToken,removeAccessToken:removeAccessToken,isNull:isNull,showClickModal:showClickModal,showTimeToast:showTimeToast,wxAuthorize:wxAuthorize,goTopEvent:goTopEvent,isscrollToPage:isscrollToPage,dataListHandle:dataListHandle,currentLocation:currentLocation,conversionAddress:conversionAddress,wxOpenSet:wxOpenSet,scopeRecord:scopeRecord,uploadAudio:uploadAudio,IsInArray:IsInArray,prompt:prompt,timeCountDown:timeCountDown,getAlter:getAlter,commonFun:commonFun,nullObject:nullObject,payAndBingPhoneSetData:payAndBingPhoneSetData,updateTabOffsetTop:updateTabOffsetTop,scrollIsTabFixed:scrollIsTabFixed,getSysInfo:getSysInfo,shareLog:shareLog,walletInfo:walletInfo,getFormId:getFormId,collect:collect};