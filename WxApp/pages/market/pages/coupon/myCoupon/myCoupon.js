"use strict";var common=getApp().globalData.commonFun,util=getApp().globalData.utilFun;Page({data:{currentTab:0,contactStatus:!0,list:[],couponData:[],couponData1:[],requestStatus:!1,interfaceName:"myCoupon"},state:{hasmore:!0,offset:0,limit:10,pageOnShow:!1,isOnReachBottom:!0,status:"",isonPullDownRefresh:!1},onLoad:function(t){wx.showLoading({title:"加载中...",mask:!0}),this.getCouponList(0),common.commonFun(this)},onShow:function(){this.state.pageOnShow&&this.getCouponList(this.state.offset)},swichNav:function(t){var s=parseInt(t.currentTarget.dataset.current);this.data.currentTab!==s&&(0===Number(s)?this.state.status="all":this.state.status="expired",this.setData({currentTab:s,requestStatus:!1,list:[]}),this.state.offset=0,this.getCouponList(0))},getCouponList:function(t){var s=this,e=getApp().globalData.acid,a="/hdh/"+e+"/mycoupon/?offset="+t+"&limit="+this.state.limit+"&status="+this.state.status;util.httpRequest(a).then(function(e){wx.hideLoading();var a=common.dataListHandle(s,e,s.data.list,t);s.state.pageOnShow=!0,s.store({list:a.list,requestStatus:!0})})},store:function(t){this.setData(t)},onPullDownRefresh:function(){this.state.isonPullDownRefresh=!0,wx.showLoading({title:"加载中...",mask:!0}),this.state.offset=0,this.getCouponList(0)},onReachBottom:function(){this.state.isonPullDownRefresh||this.state.isOnReachBottom&&this.state.hasmore&&(this.state.offset=this.state.offset+this.state.limit,this.getCouponList(this.state.offset),this.state.isOnReachBottom=!1)},jempDetail:function(t){var s=t.currentTarget.dataset.id;"not_used"===t.currentTarget.dataset.status&&wx.navigateTo({url:"../couponDetail/couponDetail?id="+s})},jempUse:function(t){var s=t.currentTarget.dataset.index,e=this.data.list[s],a=e.applicable_condition.categorie_ids,o=e.applicable_condition.product_ids;if(common.isNull(a))if(common.isNull(o))common.isNull(a)&&common.isNull(o)&&wx.redirectTo({url:"/pages/mall/pages/shopList/shopList"});else{o=o.split("|");var i=o[0];wx.redirectTo({url:"/pages/mall/pages/shopDetail/shopDetail?productId="+i})}else{a=a.split("|");var n=a[0];wx.redirectTo({url:"/pages/mall/pages/shopList/shopList?category_id="+n})}}});